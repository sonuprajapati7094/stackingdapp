<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>USDT Stacking Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.min.js"></script>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; background:#0c0c0c; color:#fff; padding:20px; }
    input, button { padding:10px; margin:8px; border-radius:8px; border:none; font-size:15px; }
    button { background:#ffb300; cursor:pointer; font-weight:bold; }
    .card { background:#1c1c1c; padding:18px; border-radius:12px; margin-bottom:20px; box-shadow:0 0 10px #222; }
    h2,h3 { color:#ffb300; }
  </style>
</head>
<body>
  <h2>USDT Stacking Dashboard (BSC Testnet)</h2>

  <div id="wallet" class="card">
    <button id="connect">üîó Connect Wallet</button>
    <div id="addr"></div>
    <div id="network"></div>
  </div>

  <div class="card">
    <label>Token Address:</label><br/>
    <input id="tokenAddr" value="0xBCE19c66E53da172F78FE800368361a8aaB51F2a" style="width:100%" />
    <br/>
    <label>Staking Contract Address:</label><br/>
    <input id="stakingAddr" value="0xdA95503f22813eceAFE4338cE9241FEae5308637" style="width:100%" />
    <br/>
    <button id="load">üöÄ Load Contracts</button>
  </div>

  <div id="actions" style="display:none">
    <div class="card">
      <h3>Deposit</h3>
      <input id="depositAmount" placeholder="Amount (e.g. 20)" />
      <input id="referrer" placeholder="Referrer address (optional)" style="width:80%" />
      <br/>
      <button id="approveBtn">‚úÖ Approve Token</button>
      <button id="depositBtn">üí∞ Deposit</button>
    </div>

    <div class="card">
      <h3>Claim & Withdraw</h3>
      <button id="claimBtn">üíé Claim ROI</button><br/>
      <input id="withdrawAmount" placeholder="Amount to withdraw" />
      <button id="withdrawBtn">üè¶ Withdraw</button>
    </div>

    <div class="card">
      <h3>Your Stats</h3>
      <div id="balance"></div>
      <div id="pending"></div>
      <div id="deposits"></div>
    </div>
  </div>

<script>
const TOKEN_ABI = [
  {"inputs":[],"stateMutability":"nonpayable","type":"constructor"},
  {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},
  {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"oldOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},
  {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},
  {"inputs":[{"internalType":"address","name":"owner_","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}
];

const STAKING_ABI = [
  "function deposit(uint256 amount, address _referrer)",
  "function claim()",
  "function withdraw(uint256 amount)",
  "function pendingRewardsOf(address) view returns (uint256)",
  "function depositsCount(address) view returns (uint256)",
  "function getDeposit(address,uint256) view returns (uint256,uint256,uint256)",
  "event DepositEvent(address indexed user,uint256 amount,address indexed referrer)",
  "event ClaimEvent(address indexed user,uint256 amount)",
  "event WithdrawEvent(address indexed user,uint256 amountAfterFee,uint256 fee)"
];

let provider, signer, userAddress;
let tokenContract, stakingContract;
let tokenDecimals = 6;

async function connect(){
  if(!window.ethereum) return alert('Please install MetaMask!');
  provider = new ethers.BrowserProvider(window.ethereum);
  await provider.send('eth_requestAccounts', []);
  signer = await provider.getSigner();
  userAddress = await signer.getAddress();
  document.getElementById('addr').innerText = 'Connected: ' + userAddress;
  document.getElementById('connect').innerText = '‚úÖ Connected';
}

async function loadContracts(){
  const tokenAddr = document.getElementById('tokenAddr').value.trim();
  const stakingAddr = document.getElementById('stakingAddr').value.trim();
  tokenContract = new ethers.Contract(tokenAddr, TOKEN_ABI, signer);
  stakingContract = new ethers.Contract(stakingAddr, STAKING_ABI, signer);
  document.getElementById('actions').style.display = 'block';
  updateUserInfo();
}

function toBase(v){ return ethers.parseUnits(v.toString(), tokenDecimals); }
function fromBase(v){ return ethers.formatUnits(v, tokenDecimals); }

async function approveToken(){
  const amt = document.getElementById('depositAmount').value;
  const tx = await tokenContract.approve(document.getElementById('stakingAddr').value, toBase(amt));
  await tx.wait(); alert('Token approved ‚úÖ');
}

async function deposit(){
  const amt = document.getElementById('depositAmount').value;
  const ref = document.getElementById('referrer').value.trim() || ethers.ZeroAddress;
  const tx = await stakingContract.deposit(toBase(amt), ref);
  await tx.wait(); alert('Deposited ‚úÖ'); updateUserInfo();
}

async function claim(){
  const tx = await stakingContract.claim();
  await tx.wait(); alert('Claim successful ‚úÖ'); updateUserInfo();
}

async function withdraw(){
  const amt = document.getElementById('withdrawAmount').value;
  const tx = await stakingContract.withdraw(toBase(amt));
  await tx.wait(); alert('Withdrawn ‚úÖ'); updateUserInfo();
}

async function updateUserInfo(){
  const bal = await tokenContract.balanceOf(userAddress);
  document.getElementById('balance').innerText = 'üí∞ Wallet Balance: ' + fromBase(bal);
  const pending = await stakingContract.pendingRewardsOf(userAddress);
  document.getElementById('pending').innerText = 'ü™ô Pending Rewards: ' + fromBase(pending);
  const cnt = await stakingContract.depositsCount(userAddress);
  let html = `üìú Total Deposits: ${cnt}<br/>`;
  for(let i=0;i<cnt;i++){
    const d = await stakingContract.getDeposit(userAddress,i);
    html += `#${i+1}: Amount ${fromBase(d[0])}, Time ${new Date(d[1]*1000).toLocaleString()}, Withdrawn ${fromBase(d[2])}<br/>`;
  }
  document.getElementById('deposits').innerHTML = html;
}

document.getElementById('connect').onclick = connect;
document.getElementById('load').onclick = loadContracts;
document.getElementById('approveBtn').onclick = approveToken;
document.getElementById('depositBtn').onclick = deposit;
document.getElementById('claimBtn').onclick = claim;
document.getElementById('withdrawBtn').onclick = withdraw;
</script>
</body>
</html>
