<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>USDT Staking dApp</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; background:#f7f7f8; margin:20px; }
  .card { background:#fff; padding:16px; border-radius:12px; margin:12px 0;
          box-shadow:0 2px 6px rgba(0,0,0,0.1);}
  button { padding:10px 16px; border:none; border-radius:8px; cursor:pointer; }
  input { padding:10px; border:1px solid #ccc; border-radius:8px; margin-right:8px; }
</style>
</head>
<body>
  <h1>ðŸš€ USDT Staking dApp (BSC Testnet)</h1>

  <div class="card">
    <button id="connectBtn">ðŸ”Œ Connect Wallet</button>
    <p><b>Account:</b> <span id="account">-</span></p>
    <p><b>Network:</b> <span id="network">-</span></p>
    <p id="status"></p>
  </div>

  <div class="card">
    <h3>Your Info</h3>
    <p>Balance: <span id="usdtBal">-</span> USDT</p>
    <p>Staked: <span id="staked">-</span></p>
    <p>Pending Rewards: <span id="pending">-</span></p>
    <p>Lock End: <span id="lockEnd">-</span></p>
  </div>

  <div class="card">
    <h3>Stake</h3>
    <input id="depAmt" placeholder="Amount (USDT)"/>
    <button id="approveBtn">Approve</button>
    <button id="depositBtn">Deposit</button>
  </div>

  <div class="card">
    <h3>Claim</h3>
    <button id="claimBtn">Claim Rewards</button>
  </div>

  <div class="card">
    <h3>Withdraw</h3>
    <input id="wdAmt" placeholder="Amount (USDT)"/>
    <button id="withdrawBtn">Withdraw</button>
  </div>

<script>
// ==== CONFIG ====
// apne addresses yahan daalo
const STAKING_ADDRESS = "0x71E78A6621A3Af5B7A6B7f24257032c2D1d30F7f";
const TOKEN_ADDRESS   = "0x8B953059f82F4C5B68E3Ec978F5559588fD2972D";
const DEC = 6;

// ==== ABIs ====
const STAKING_ABI = [
  "function users(address) view returns (uint256 totalDeposited,uint256 staked,uint256 rewardDebt,uint256 paidRewards,uint256 paidReferrals,uint256 lastAccrue,uint256 lockEnd,address upline)",
  "function pendingRewards(address) view returns (uint256)",
  "function remainingToCap(address) view returns (uint256)",
  "function minTx() view returns (uint256)",
  "function deposit(uint256 amount, address referrer)",
  "function claimRewards()",
  "function withdrawPrincipal(uint256 amount)"
];
const ERC20_ABI = [
  "function balanceOf(address) view returns (uint256)",
  "function allowance(address,address) view returns (uint256)",
  "function approve(address,uint256) returns (bool)",
  "function decimals() view returns (uint8)"
];

// ==== Globals ====
let provider, signer, account, staking, usdt;

// ==== Helpers ====
const $ = id => document.getElementById(id);
const fmt = (n, d=DEC)=> Number(ethers.utils.formatUnits(n, d)).toLocaleString(undefined,{maximumFractionDigits:6});
const parse = (x, d=DEC)=> ethers.utils.parseUnits(String(x||"0"), d);
const ts = (t)=> Number(t) ? new Date(Number(t)*1000).toLocaleString() : "-";
function setStatus(msg){ $("status").textContent = msg; }

// ==== Connect ====
async function connect(){
  if(!window.ethereum){ alert("MetaMask not found"); return; }
  try {
    await window.ethereum.request({ method: "eth_requestAccounts" });
    provider = new ethers.providers.Web3Provider(window.ethereum);
    signer   = provider.getSigner();
    account  = await signer.getAddress();
    staking  = new ethers.Contract(STAKING_ADDRESS, STAKING_ABI, signer);
    usdt     = new ethers.Contract(TOKEN_ADDRESS, ERC20_ABI, signer);

    $("account").textContent = account;
    $("network").textContent = "BSC Testnet";
    setStatus("Connected âœ”");

    await refresh();
  } catch(e){ console.error(e); setStatus("Connect failed: "+e.message); }
}

// ==== Refresh ====
async function refresh(){
  try {
    const bal = await usdt.balanceOf(account);
    $("usdtBal").textContent = fmt(bal);
  } catch(e){ $("usdtBal").textContent = "0"; }

  try {
    const u = await staking.users(account);
    $("staked").textContent = fmt(u.staked);
    $("lockEnd").textContent = ts(u.lockEnd);
  } catch(e){ $("staked").textContent = "0"; $("lockEnd").textContent = "-"; }

  try {
    const pend = await staking.pendingRewards(account);
    $("pending").textContent = fmt(pend);
  } catch(e){ $("pending").textContent = "0"; }
}

// ==== Approve ====
async function approve(){
  try {
    const amt = $("depAmt").value;
    const units = parse(amt);
    const tx = await usdt.approve(STAKING_ADDRESS, units);
    await tx.wait();
    setStatus("Approve success âœ”");
  } catch(e){ console.error(e); setStatus("Approve failed: "+e.message); }
}

// ==== Deposit ====
async function deposit(){
  try {
    const amt = $("depAmt").value;
    const units = parse(amt);
    const tx = await staking.deposit(units, ethers.constants.AddressZero);
    await tx.wait();
    setStatus("Deposit success âœ”");
    await refresh();
  } catch(e){ console.error(e); setStatus("Deposit failed: "+e.message); }
}

// ==== Claim ====
async function claim(){
  try {
    const tx = await staking.claimRewards();
    await tx.wait();
    setStatus("Claim success âœ”");
    await refresh();
  } catch(e){ console.error(e); setStatus("Claim failed: "+e.message); }
}

// ==== Withdraw ====
async function withdraw(){
  try {
    const amt = $("wdAmt").value;
    const units = parse(amt);
    const tx = await staking.withdrawPrincipal(units);
    await tx.wait();
    setStatus("Withdraw success âœ”");
    await refresh();
  } catch(e){ console.error(e); setStatus("Withdraw failed: "+e.message); }
}

// ==== Event Bindings ====
$("connectBtn").onclick = connect;
$("approveBtn").onclick = approve;
$("depositBtn").onclick = deposit;
$("claimBtn").onclick = claim;
$("withdrawBtn").onclick = withdraw;

</script>
</body>
</html>
