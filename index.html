<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>USDT Staking â€” Final Dashboard (Local Ethers)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{background:#0b0b0c;color:#fff;font-family:Inter,system-ui,Arial;margin:0;padding:28px;display:flex;flex-direction:column;align-items:center}
    h1{margin:0 0 18px;font-size:28px}
    .card{background:#17171a;padding:20px;border-radius:12px;margin:12px 0;box-shadow:0 6px 20px rgba(0,0,0,0.5);width:460px;max-width:95%}
    button{cursor:pointer;border:0;padding:10px 16px;border-radius:8px;font-weight:600}
    .btn-yellow{background:#ffcc29;color:#111}
    .btn-dark{background:#2b2b2f;color:#fff}
    .btn-red{background:#e04646;color:#fff}
    input{padding:12px;border-radius:8px;border:0;background:#262628;color:#fff;width:240px}
    .center{text-align:center}
    .muted{color:#bdbdbd;font-size:14px}
    .small{font-size:13px;color:#999;margin-top:8px}
  </style>
</head>
<body>
  <h1>ðŸš€ USDT Staking â€” Final (Local Ethers)</h1>
  <div id="walletText" class="muted">Wallet: not connected</div>
  <div style="margin:14px"><button id="connectBtn" class="btn-yellow">Connect Wallet</button></div>

  <div class="card center">
    <h3>Approve & Stake</h3>
    <input id="amountInput" placeholder="Amount (USDT)" />
    <div style="margin-top:12px">
      <button class="btn-dark" id="approveBtn">Approve</button>
      <button class="btn-yellow" id="depositBtn">Deposit</button>
    </div>
  </div>

  <div class="card center">
    <h3>Rewards</h3>
    <button class="btn-dark" id="pendingBtn">Check Pending Rewards</button>
    <div id="rewardsText" class="muted" style="margin:10px">Rewards: 0 USDT</div>
    <button class="btn-yellow" id="claimBtn">Claim Rewards</button>
  </div>

  <div class="card center">
    <h3>Withdraw</h3>
    <input id="withdrawInput" placeholder="Amount (USDT)" />
    <div style="margin-top:12px">
      <button class="btn-red" id="withdrawBtn">Withdraw</button>
    </div>
  </div>

  <div class="card center">
    <h3>ðŸ“Š Staking Info</h3>
    <button class="btn-dark" id="stakedBtn">Check Staked Balance</button>
    <div id="stakedInfo" class="muted" style="margin-top:14px">-</div>
  </div>

  <!-- âœ… Local ethers script -->
  <script src="libs/ethers.min.js"></script>

  <script>
  (async function(){
    const STAKING_ADDRESS = "0x20Fbd4AF3cB507e702C7C513F08D7857bAc74407";
    const TOKEN_ADDRESS   = "0xEbA5032Be8fc2d2a2fa29e134853ab6aAA12fa1C";

    const tokenAbi = [
      "function decimals() view returns (uint8)",
      "function approve(address,uint256) returns (bool)"
    ];
    const stakingAbi = [
      "function deposit(uint256,address)",
      "function claimRewards()",
      "function withdrawPrincipal(uint256)",
      "function pendingRewards(address) view returns (uint256)",
      "function getUserInfo(address) view returns (uint256,uint256,address,uint256,uint256)"
    ];

    const connectBtn = document.getElementById("connectBtn");
    const walletText = document.getElementById("walletText");
    const amountInput = document.getElementById("amountInput");
    const approveBtn = document.getElementById("approveBtn");
    const depositBtn = document.getElementById("depositBtn");
    const pendingBtn = document.getElementById("pendingBtn");
    const rewardsText = document.getElementById("rewardsText");
    const claimBtn = document.getElementById("claimBtn");
    const withdrawInput = document.getElementById("withdrawInput");
    const withdrawBtn = document.getElementById("withdrawBtn");
    const stakedBtn = document.getElementById("stakedBtn");
    const stakedInfo = document.getElementById("stakedInfo");

    let provider, signer, userAddress, token, staking, decimals = 6;

    function fmt(bn){ try { return ethers.utils.formatUnits(bn, decimals); } catch(e){ return "0"; } }
    function toUnits(v){ return ethers.utils.parseUnits(v||"0", decimals); }

    async function connect(){
      try{
        if (!window.ethereum) { alert("No MetaMask detected"); return; }
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        userAddress = await signer.getAddress();
        walletText.textContent = "Wallet: " + userAddress;
        connectBtn.textContent = "Connected";

        token = new ethers.Contract(TOKEN_ADDRESS, tokenAbi, signer);
        staking = new ethers.Contract(STAKING_ADDRESS, stakingAbi, signer);
        decimals = await token.decimals();
      }catch(err){
        alert("Wallet connect failed: " + err.message);
      }
    }
    connectBtn.onclick = connect;

    approveBtn.onclick = async ()=>{
      const amt = toUnits(amountInput.value);
      const tx = await token.approve(STAKING_ADDRESS, amt);
      await tx.wait();
      alert("Approved");
    };

    depositBtn.onclick = async ()=>{
      const amt = toUnits(amountInput.value);
      const tx = await staking.deposit(amt, ethers.constants.AddressZero);
      await tx.wait();
      alert("Deposited");
    };

    pendingBtn.onclick = async ()=>{
      const p = await staking.pendingRewards(userAddress);
      rewardsText.textContent = "Rewards: " + fmt(p) + " USDT";
    };

    claimBtn.onclick = async ()=>{
      const tx = await staking.claimRewards();
      await tx.wait();
      alert("Claimed");
    };

    withdrawBtn.onclick = async ()=>{
      const amt = toUnits(withdrawInput.value);
      const tx = await staking.withdrawPrincipal(amt);
      await tx.wait();
      alert("Withdrawn");
    };

    stakedBtn.onclick = async ()=>{
      const info = await staking.getUserInfo(userAddress);
      stakedInfo.innerHTML = `
        Staked: ${fmt(info[0])} USDT<br>
        Pending: ${fmt(info[4])} USDT<br>
        Total Earned: ${fmt(info[3])} USDT
      `;
    };
  })();
  </script>
</body>
</html>
