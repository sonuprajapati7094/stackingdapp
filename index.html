<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸª™ USDT Staking â€” Pro Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <style>
    body { background:#111; color:#fff; font-family:Arial; text-align:center; }
    .card { background:#1e1e1e; padding:20px; margin:20px auto; width:400px; border-radius:12px; }
    button { padding:10px 20px; border:none; border-radius:6px; margin:5px; cursor:pointer; }
    .primary { background:#facc15; color:#000; }
    .secondary { background:#333; color:#fff; }
    .danger { background:#ef4444; color:#fff; }
  </style>
</head>
<body>
  <h2>ðŸª™ USDT Staking â€” Pro Dashboard</h2>

  <button id="connectBtn" class="primary" onclick="connectWallet()">ðŸ”— Connect Wallet</button>
  <p id="wallet-address">Wallet: not connected</p>

  <div class="card">
    <h3>Approve & Stake</h3>
    <input type="number" id="stakeAmount" placeholder="Amount (USDT)">
    <button class="secondary" onclick="approve()">Approve</button>
    <button class="primary" onclick="deposit()">Deposit</button>
  </div>

  <div class="card">
    <h3>Rewards</h3>
    <button class="secondary" onclick="checkRewards()">Check Pending Rewards</button>
    <p id="rewards">Rewards: 0 USDT</p>
    <button class="primary" onclick="claimRewards()">Claim Rewards</button>
  </div>

  <div class="card">
    <h3>Withdraw</h3>
    <input type="number" id="withdrawAmount" placeholder="Amount (USDT)">
    <button class="danger" onclick="withdrawPrincipal()">Withdraw</button>
  </div>

  <div class="card">
    <h3>ðŸ“Š Staking Info</h3>
    <button class="secondary" onclick="checkStaked()">Check Staked Balance</button>
    <p id="staked">Staked: - USDT</p>
    <p id="target">Target (3x cap): - USDT</p>
    <p id="days">Days to reach 3x: - days</p>
  </div>

<script>
let web3;
let accounts;

// Contracts
const STAKING_ADDRESS = "0x20Fbd4AF3cB507e702C7C513F08D7857bAc74407";
const TOKEN_ADDRESS = "0xEbA5032Be8fc2d2a2fa29e134853ab6aAA12fa1C";

// âœ… Token ABI
const tokenAbi = [
  { "inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],
    "name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
  { "inputs":[{"internalType":"address","name":"account","type":"address"}],
    "name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  { "inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"}
];

// âœ… Staking ABI
const stakingAbi = [
  { "inputs":[{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"address","name":"referrer","type":"address"}],
    "name":"deposit","outputs":[],"stateMutability":"nonpayable","type":"function"},
  { "inputs":[],"name":"claimRewards","outputs":[],"stateMutability":"nonpayable","type":"function"},
  { "inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],
    "name":"withdrawPrincipal","outputs":[],"stateMutability":"nonpayable","type":"function"},
  { "inputs":[{"internalType":"address","name":"userAddr","type":"address"}],
    "name":"pendingRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  { "inputs":[{"internalType":"address","name":"","type":"address"}],
    "name":"users","outputs":[
      {"internalType":"uint256","name":"staked","type":"uint256"},
      {"internalType":"uint256","name":"rewardDebt","type":"uint256"},
      {"internalType":"uint256","name":"lastAction","type":"uint256"},
      {"internalType":"address","name":"referrer","type":"address"},
      {"internalType":"uint256","name":"totalEarned","type":"uint256"}
    ],"stateMutability":"view","type":"function"}
];

let tokenContract, stakingContract;

// âœ… Connect Wallet
async function connectWallet() {
  if (typeof window.ethereum !== "undefined") {
    await window.ethereum.request({ method: "eth_requestAccounts" });
    web3 = new Web3(window.ethereum);
    accounts = await web3.eth.getAccounts();
    document.getElementById("wallet-address").innerText = "Wallet: " + accounts[0];
    tokenContract = new web3.eth.Contract(tokenAbi, TOKEN_ADDRESS);
    stakingContract = new web3.eth.Contract(stakingAbi, STAKING_ADDRESS);
    console.log("Wallet connected:", accounts[0]);
  } else {
    alert("MetaMask not found!");
  }
}

// âœ… Approve
async function approve() {
  let amount = document.getElementById("stakeAmount").value;
  let decimals = await tokenContract.methods.decimals().call();
  let value = web3.utils.toBN(amount).mul(web3.utils.toBN(10).pow(web3.utils.toBN(decimals)));
  await tokenContract.methods.approve(STAKING_ADDRESS, value).send({ from: accounts[0] });
  alert("Approved " + amount + " USDT for staking.");
}

// âœ… Deposit
async function deposit() {
  let amount = document.getElementById("stakeAmount").value;
  let decimals = await tokenContract.methods.decimals().call();
  let value = web3.utils.toBN(amount).mul(web3.utils.toBN(10).pow(web3.utils.toBN(decimals)));
  await stakingContract.methods.deposit(value, "0x0000000000000000000000000000000000000000").send({ from: accounts[0] });
  alert("Deposited " + amount + " USDT");
}

// âœ… Rewards
async function checkRewards() {
  let rewards = await stakingContract.methods.pendingRewards(accounts[0]).call();
  document.getElementById("rewards").innerText = "Rewards: " + (rewards/1e6) + " USDT";
}
async function claimRewards() {
  await stakingContract.methods.claimRewards().send({ from: accounts[0] });
  alert("Rewards claimed!");
}

// âœ… Withdraw
async function withdrawPrincipal() {
  let amount = document.getElementById("withdrawAmount").value;
  let decimals = await tokenContract.methods.decimals().call();
  let value = web3.utils.toBN(amount).mul(web3.utils.toBN(10).pow(web3.utils.toBN(decimals)));
  await stakingContract.methods.withdrawPrincipal(value).send({ from: accounts[0] });
  alert("Withdrawn " + amount + " USDT");
}

// âœ… Staking Info
async function checkStaked() {
  let user = await stakingContract.methods.users(accounts[0]).call();
  let staked = user.staked / 1e6;
  let target = staked * 3;
  let days = Math.ceil((target - staked) / (staked * 0.00049)); // approx calc
  document.getElementById("staked").innerText = "Staked: " + staked + " USDT";
  document.getElementById("target").innerText = "Target (3x cap): " + target + " USDT";
  document.getElementById("days").innerText = "Days to reach 3x: " + days + " days";
}
</script>
</body>
</html>
