<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸŒ™ USDT Staking â€” Pro Dashboard</title>
<head>
  <meta charset="UTF-8">
  <title>ðŸŒ™ USDT Staking â€” Pro Dashboard</title>
  <!-- Ethers.js must load here -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    /* styling */
  </style>
</head>
  <style>
    body { background:#111; color:#fff; font-family: Arial, sans-serif; text-align:center; }
    .container { max-width:600px; margin:20px auto; padding:20px; background:#1e1e1e; border-radius:12px; box-shadow:0 0 10px #000; }
    button { padding:10px 20px; margin:5px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; }
    .connect { background:#facc15; }
    .approve { background:#333; color:#fff; }
    .deposit { background:#facc15; }
    .claim { background:#facc15; }
    .withdraw { background:#dc2626; color:#fff; }
    input { padding:10px; margin:5px; border-radius:6px; border:none; width:200px; text-align:center; }
    h2 { margin-top:20px; color:#facc15; }
    .section { margin:20px 0; padding:15px; background:#2a2a2a; border-radius:10px; }
  </style>
</head>
<body>
  <h1>ðŸŒ™ USDT Staking â€” Pro Dashboard</h1>
  <button onclick="connectWallet()" class="connect">ðŸ”— Connect Wallet</button>
  <p id="wallet">Wallet: not connected</p>

  <div class="container">
    <div class="section">
      <h2>Approve & Stake</h2>
      <input id="amount" type="number" placeholder="Amount (USDT)" />
      <button onclick="approve()" class="approve">Approve</button>
      <button onclick="deposit()" class="deposit">Deposit</button>
    </div>

    <div class="section">
      <h2>Rewards</h2>
      <button onclick="checkPendingRewards()">Check Pending Rewards</button>
      <p id="rewards">Rewards: 0 USDT</p>
      <button onclick="claimRewards()" class="claim">Claim Rewards</button>
    </div>

    <div class="section">
      <h2>Withdraw</h2>
      <input id="withdrawAmount" type="number" placeholder="Amount (USDT)" />
      <button onclick="withdrawPrincipal()" class="withdraw">Withdraw</button>
    </div>

    <div class="section">
      <h2>ðŸ“Š Staking Info</h2>
      <button onclick="checkStakedInfo()">Check Staked Balance</button>
      <p id="stakedInfo">-</p>
    </div>
  </div>

<script>
let provider, signer, tokenContract, stakingContract;

const STAKING_ADDRESS = "0x20Fbd4AF3cB507e702C7C513F08D7857bAc74407"; // staking contract
const TOKEN_ADDRESS   = "0xEbA5032Be8fc2d2a2fa29e134853ab6aAA12fa1C"; // mock usdt

// ---- Token ABI ----
const tokenAbi = [
  "function approve(address spender,uint256 amount) external returns(bool)",
  "function allowance(address owner,address spender) external view returns(uint256)",
  "function balanceOf(address account) external view returns(uint256)",
  "function decimals() external view returns(uint8)"
];

// ---- Staking ABI ----
const stakingAbi = [
  "function deposit(uint256 amount,address referrer) external",
  "function claimRewards() external",
  "function withdrawPrincipal(uint256 amount) external",
  "function pendingRewards(address userAddr) external view returns(uint256)",
  "function users(address) view returns (uint256 staked, uint256 rewardDebt, uint256 lastAction, address referrer, uint256 totalEarned)"
];

async function connectWallet() {
  try {
    if (!window.ethereum) return alert("MetaMask not installed");
    provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    signer = provider.getSigner();
    const addr = await signer.getAddress();
    document.getElementById("wallet").innerText = "Wallet: " + addr;

    tokenContract = new ethers.Contract(TOKEN_ADDRESS, tokenAbi, signer);
    stakingContract = new ethers.Contract(STAKING_ADDRESS, stakingAbi, signer);

    alert("Wallet connected successfully âœ…");
  } catch (err) {
    alert("Wallet connection failed: " + err.message);
  }
}

async function approve() {
  try {
    const amount = document.getElementById("amount").value;
    const decimals = await tokenContract.decimals();
    const tx = await tokenContract.approve(STAKING_ADDRESS, ethers.utils.parseUnits(amount, decimals));
    await tx.wait();
    alert("Approval successful âœ…");
  } catch (err) {
    alert("Approval failed: " + err.message);
  }
}

async function deposit() {
  try {
    const amount = document.getElementById("amount").value;
    const decimals = await tokenContract.decimals();
    const tx = await stakingContract.deposit(ethers.utils.parseUnits(amount, decimals), ethers.constants.AddressZero);
    await tx.wait();
    alert("Deposit successful âœ…");
  } catch (err) {
    alert("Deposit failed: " + err.message);
  }
}

async function checkPendingRewards() {
  try {
    const addr = await signer.getAddress();
    const rewards = await stakingContract.pendingRewards(addr);
    document.getElementById("rewards").innerText = "Rewards: " + ethers.utils.formatUnits(rewards, 6) + " USDT";
  } catch (err) {
    alert("Error fetching rewards: " + err.message);
  }
}

async function claimRewards() {
  try {
    const tx = await stakingContract.claimRewards();
    await tx.wait();
    alert("Rewards claimed âœ…");
  } catch (err) {
    alert("Claim failed: " + err.message);
  }
}

async function withdrawPrincipal() {
  try {
    const amount = document.getElementById("withdrawAmount").value;
    const decimals = await tokenContract.decimals();
    const tx = await stakingContract.withdrawPrincipal(ethers.utils.parseUnits(amount, decimals));
    await tx.wait();
    alert("Withdraw successful âœ…");
  } catch (err) {
    alert("Withdraw failed: " + err.message);
  }
}

async function checkStakedInfo() {
  try {
    const addr = await signer.getAddress();
    const user = await stakingContract.users(addr);

    // access struct safely (object or array)
    const staked = ethers.utils.formatUnits(user.staked || user[0], 6);
    const rewardDebt = ethers.utils.formatUnits(user.rewardDebt || user[1], 6);
    const totalEarned = ethers.utils.formatUnits(user.totalEarned || user[4], 6);

    document.getElementById("stakedInfo").innerText =
      `Staked: ${staked} USDT | Reward Debt: ${rewardDebt} USDT | Total Earned: ${totalEarned} USDT`;
  } catch (err) {
    alert("Error fetching staked info: " + err.message);
  }
}
</script>
</body>
</html>
