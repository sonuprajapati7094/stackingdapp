<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>USDT Staking DApp</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.7.5/dist/web3.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #fff; text-align: center; }
    .container { margin-top: 50px; }
    button { margin: 10px; padding: 10px 20px; cursor: pointer; }
    input { margin: 5px; padding: 8px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ’¸ USDT Staking DApp</h1>
    <button onclick="connectWallet()">ðŸ”— Connect Wallet</button>
    <p id="wallet">Wallet: Not Connected</p>
    
    <h3>Approve & Stake</h3>
    <input type="number" id="stakeAmount" placeholder="Amount (USDT)">
    <button onclick="approveTokens()">Approve</button>
    <button onclick="depositTokens()">Deposit</button>
    
    <h3>Rewards</h3>
    <button onclick="checkRewards()">Check Pending Rewards</button>
    <p id="rewards">Rewards: 0 USDT</p>
    <button onclick="claimRewards()">Claim Rewards</button>
    
    <h3>Withdraw</h3>
    <input type="number" id="withdrawAmount" placeholder="Amount (USDT)">
    <button onclick="withdrawPrincipal()">Withdraw</button>
  </div>

  <script>
    // ---------------- CONFIG ----------------
    const STAKING_ADDRESS = "0x8B336d8c0e8905aAd3583D93D187A9072e647662"; // replace
    const TOKEN_ADDRESS   = "0xEbA5032Be8fc2d2a2fa29e134853ab6aAA12fa1C";   // replace

    // ---------------- ABI IMPORT ----------------
    const stakingAbi = [
  {
    "inputs": [
      { "internalType": "uint256", "name": "amount", "type": "uint256" },
      { "internalType": "address", "name": "referrer", "type": "address" }
    ],
    "name": "deposit",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "claimRewards",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      { "internalType": "uint256", "name": "amount", "type": "uint256" }
    ],
    "name": "withdrawPrincipal",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      { "internalType": "address", "name": "userAddr", "type": "address" }
    ],
    "name": "pendingRewards",
    "outputs": [
      { "internalType": "uint256", "name": "", "type": "uint256" }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      { "internalType": "address", "name": "userAddr", "type": "address" }
    ],
    "name": "users",
    "outputs": [
      { "internalType": "uint256", "name": "staked", "type": "uint256" },
      { "internalType": "uint256", "name": "rewardDebt", "type": "uint256" },
      { "internalType": "uint256", "name": "lastAction", "type": "uint256" },
      { "internalType": "address", "name": "referrer", "type": "address" },
      { "internalType": "uint256", "name": "totalEarned", "type": "uint256" }
    ],
    "stateMutability": "view",
    "type": "function"
  }
];
; // paste from Remix
    const tokenAbi   = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "owner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "spender",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "value",
				"type": "uint256"
			}
		],
		"name": "Approval",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "value",
				"type": "uint256"
			}
		],
		"name": "Transfer",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "owner_",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "spender",
				"type": "address"
			}
		],
		"name": "allowance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "spender",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "approve",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			}
		],
		"name": "balanceOf",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "decimals",
		"outputs": [
			{
				"internalType": "uint8",
				"name": "",
				"type": "uint8"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "mint",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "name",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "symbol",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "totalSupply",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "transfer",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "transferFrom",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	}
];   // paste from Remix

    let web3, accounts, staking, token;

    // ---------------- CONNECT WALLET ----------------
    async function connectWallet() {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        accounts = await ethereum.request({ method: "eth_requestAccounts" });
        document.getElementById("wallet").innerText = "Wallet: " + accounts[0];
        staking = new web3.eth.Contract(stakingAbi, STAKING_ADDRESS);
        token   = new web3.eth.Contract(tokenAbi, TOKEN_ADDRESS);
      } else {
        alert("Please install MetaMask!");
      }
    }

    // ---------------- APPROVE ----------------
    async function approveTokens() {
      let amount = document.getElementById("stakeAmount").value;
      let decimals = await token.methods.decimals().call();
      let value = web3.utils.toBN(amount * 10 ** decimals);
      await token.methods.approve(STAKING_ADDRESS, value).send({ from: accounts[0] });
      alert("Approved " + amount + " USDT");
    }

    // ---------------- DEPOSIT ----------------
    async function depositTokens() {
      let amount = document.getElementById("stakeAmount").value;
      let decimals = await token.methods.decimals().call();
      let value = web3.utils.toBN(amount * 10 ** decimals);
      await staking.methods.deposit(value, "0x0000000000000000000000000000000000000000").send({ from: accounts[0] });
      alert("Deposited " + amount + " USDT");
    }

    // ---------------- REWARDS ----------------
    async function checkRewards() {
      let rewards = await staking.methods.pendingRewards(accounts[0]).call();
      let decimals = await token.methods.decimals().call();
      document.getElementById("rewards").innerText = "Rewards: " + (rewards / 10 ** decimals) + " USDT";
    }

    async function claimRewards() {
      await staking.methods.claimRewards().send({ from: accounts[0] });
      alert("Rewards claimed!");
    }

    // ---------------- WITHDRAW ----------------
    async function withdrawPrincipal() {
      let amount = document.getElementById("withdrawAmount").value;
      let decimals = await token.methods.decimals().call();
      let value = web3.utils.toBN(amount * 10 ** decimals);
      await staking.methods.withdrawPrincipal(value).send({ from: accounts[0] });
      alert("Withdrawn " + amount + " USDT");
    }
  </script>
</body>
</html>
