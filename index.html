<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ü™ô USDT Staking ‚Äî Pro Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <style>
    body { background:#111; color:#fff; font-family:Arial, sans-serif; text-align:center; }
    .card { background:#1c1c1c; padding:20px; margin:20px auto; border-radius:10px; max-width:500px; }
    button { margin:5px; padding:10px 20px; border:none; border-radius:6px; cursor:pointer; }
    button:hover { opacity:0.9; }
    .primary { background:#f0b90b; color:#000; }
    .secondary { background:#333; color:#fff; }
    .danger { background:#d9534f; color:#fff; }
    .info { background:#0275d8; color:#fff; }
    .progress { height:10px; background:#333; border-radius:5px; margin-top:10px; }
    .progress-bar { height:10px; background:#f0b90b; border-radius:5px; width:0%; }
  </style>
</head>
<body>
  <h2>ü™ô USDT Staking ‚Äî Pro Dashboard</h2>
  <button id="connectBtn" class="primary">üîó Connect Wallet</button>
  <p id="wallet">Wallet: not connected</p>

  <div class="card">
    <h3>Approve & Stake</h3>
    <input type="number" id="stakeAmount" placeholder="Amount (USDT)" />
    <button onclick="approve()" class="secondary">Approve</button>
    <button onclick="deposit()" class="primary">Deposit</button>
  </div>

  <div class="card">
    <h3>Rewards</h3>
    <button onclick="checkRewards()" class="secondary">Check Pending Rewards</button>
    <p id="rewards">Rewards: 0 USDT</p>
    <button onclick="claimRewards()" class="primary">Claim Rewards</button>
  </div>

  <div class="card">
    <h3>Withdraw</h3>
    <input type="number" id="withdrawAmount" placeholder="Amount (USDT)" />
    <button onclick="withdraw()" class="danger">Withdraw</button>
  </div>

  <div class="card">
    <h3>üìä Staking Info</h3>
    <button onclick="checkStaked()" class="info">Check Staked Balance</button>
    <p id="staked">Staked: - USDT</p>
    <p id="target">Target (3x cap): - USDT</p>
    <p id="days">Days to reach 3x: - days</p>
    <div class="progress"><div id="progressBar" class="progress-bar"></div></div>
    <p id="lastUpdate">Last updated: never</p>
  </div>

  <p id="status" style="color:red;">Connection failed</p>

<script>
const STAKING_ADDRESS = "0x8B336d8c0e8905aAd3583D93D187A9072e647662";
const TOKEN_ADDRESS   = "0xEbA5032Be8fc2d2a2fa29e134853ab6aAA12fa1C";

// ‚úÖ MockUSDT ABI
const tokenAbi = [
  {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"mint","outputs":[],"stateMutability":"nonpayable","type":"function"}
];

// ‚úÖ Staking Contract ABI
const stakingAbi = [
  {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"address","name":"referrer","type":"address"}],"name":"deposit","outputs":[],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[],"name":"claimRewards","outputs":[],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdrawPrincipal","outputs":[],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"internalType":"address","name":"userAddr","type":"address"}],"name":"pendingRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"userAddr","type":"address"}],"name":"users","outputs":[{"internalType":"uint256","name":"staked","type":"uint256"},{"internalType":"uint256","name":"rewardDebt","type":"uint256"},{"internalType":"uint256","name":"lastAction","type":"uint256"},{"internalType":"address","name":"referrer","type":"address"},{"internalType":"uint256","name":"totalEarned","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"roiBP","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"capX","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
];

let provider, signer, token, staking, user;

async function connectWallet() {
  try {
    await window.ethereum.request({ method: "eth_requestAccounts" });
    provider = new ethers.providers.Web3Provider(window.ethereum);
    signer = provider.getSigner();
    user = await signer.getAddress();
    token = new ethers.Contract(TOKEN_ADDRESS, tokenAbi, signer);
    staking = new ethers.Contract(STAKING_ADDRESS, stakingAbi, signer);
    document.getElementById("wallet").innerText = "Wallet: " + user;
    document.getElementById("status").innerText = "‚úÖ Connected";
  } catch (err) {
    document.getElementById("status").innerText = "‚ùå Connection failed";
  }
}

async function approve() {
  const amount = document.getElementById("stakeAmount").value;
  await token.approve(STAKING_ADDRESS, ethers.utils.parseUnits(amount, 6));
}

async function deposit() {
  const amount = document.getElementById("stakeAmount").value;
  await staking.deposit(ethers.utils.parseUnits(amount, 6), ethers.constants.AddressZero);
}

async function checkRewards() {
  const reward = await staking.pendingRewards(user);
  document.getElementById("rewards").innerText = "Rewards: " + ethers.utils.formatUnits(reward, 6) + " USDT";
}

async function claimRewards() {
  await staking.claimRewards();
}

async function withdraw() {
  const amount = document.getElementById("withdrawAmount").value;
  await staking.withdrawPrincipal(ethers.utils.parseUnits(amount, 6));
}

async function checkStaked() {
  const userInfo = await staking.users(user);
  const staked = parseFloat(ethers.utils.formatUnits(userInfo.staked, 6));
  const target = staked * 3;
  const roi = await staking.roiBP(); // basis points
  const dailyRoi = roi.toNumber() / 10000 / 365;
  const daysTo3x = (target - staked) / (staked * dailyRoi);
  document.getElementById("staked").innerText = "Staked: " + staked + " USDT";
  document.getElementById("target").innerText = "Target (3x cap): " + target.toFixed(2) + " USDT";
  document.getElementById("days").innerText = "Days to reach 3x: " + daysTo3x.toFixed(0) + " days";
  document.getElementById("progressBar").style.width = ((staked/target)*100).toFixed(0) + "%";
  document.getElementById("lastUpdate").innerText = "Last updated: " + new Date().toLocaleTimeString();
}

document.getElementById("connectBtn").addEventListener("click", connectWallet);
</script>
</body>
</html>
