<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>USDT Staking â€” Pro Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { background:#0d0d0d; color:#fff; font-family:Arial, sans-serif; text-align:center; }
    .container { max-width:600px; margin:40px auto; padding:20px; }
    button { padding:10px 18px; margin:6px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; }
    .primary { background:#facc15; color:#000; }
    .danger { background:#dc2626; color:#fff; }
    .dark { background:#1f1f1f; color:#fff; }
    .card { background:#111; padding:20px; border-radius:10px; margin:20px 0; }
    input { padding:10px; border-radius:6px; border:none; width:70%; margin:8px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h2>ðŸŒ™ USDT Staking â€” Pro Dashboard</h2>
    <button class="primary" onclick="connectWallet()">ðŸ”— Connect Wallet</button>
    <p id="walletAddress">Wallet: not connected</p>

    <div class="card">
      <h3>Approve & Stake</h3>
      <input id="stakeAmount" placeholder="Amount (USDT)">
      <div>
        <button class="dark" onclick="approve()">Approve</button>
        <button class="primary" onclick="deposit()">Deposit</button>
      </div>
    </div>

    <div class="card">
      <h3>Rewards</h3>
      <button class="dark" onclick="checkPending()">Check Pending Rewards</button>
      <p id="pendingRewards">Rewards: 0 USDT</p>
      <button class="primary" onclick="claimRewards()">Claim Rewards</button>
    </div>

    <div class="card">
      <h3>Withdraw</h3>
      <input id="withdrawAmount" placeholder="Amount (USDT)">
      <button class="danger" onclick="withdraw()">Withdraw</button>
    </div>

    <div class="card">
      <h3>ðŸ“Š Staking Info</h3>
      <button class="dark" onclick="checkStakedInfo()">Check Staked Balance</button>
      <p id="stakedInfo">-</p>
    </div>
  </div>

<script>
  // ================= CONFIG ==================
  const STAKING_ADDRESS = "0x20Fbd4AF3cB507e702C7C513F08D7857bAc74407"; // replace if redeployed
  const TOKEN_ADDRESS   = "0xEbA5032Be8fc2d2a2fa29e134853ab6aAA12fa1C"; // MockUSDT

  // ============ STAKING ABI (shortened essential) ============
  const stakingAbi = [
    { "inputs":[{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"address","name":"referrer","type":"address"}],
      "name":"deposit","outputs":[],"stateMutability":"nonpayable","type":"function"},
    { "inputs":[],"name":"claimRewards","outputs":[],"stateMutability":"nonpayable","type":"function"},
    { "inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],
      "name":"withdrawPrincipal","outputs":[],"stateMutability":"nonpayable","type":"function"},
    { "inputs":[{"internalType":"address","name":"userAddr","type":"address"}],
      "name":"pendingRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],
      "stateMutability":"view","type":"function"},
    { "inputs":[{"internalType":"address","name":"","type":"address"}],
      "name":"users","outputs":[
        {"internalType":"uint256","name":"staked","type":"uint256"},
        {"internalType":"uint256","name":"rewardDebt","type":"uint256"},
        {"internalType":"uint256","name":"lastAction","type":"uint256"},
        {"internalType":"address","name":"referrer","type":"address"},
        {"internalType":"uint256","name":"totalEarned","type":"uint256"}
      ],"stateMutability":"view","type":"function"}
  ];

  // ============ TOKEN ABI (ERC20 essentials) ============
  const tokenAbi = [
    {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],
     "name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],
     "stateMutability":"nonpayable","type":"function"},
    {"inputs":[{"internalType":"address","name":"account","type":"address"}],
     "name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],
     "stateMutability":"view","type":"function"}
  ];

  let provider, signer, stakingContract, tokenContract;

  // ============ Connect Wallet ============
  async function connectWallet() {
    if (typeof window.ethereum === "undefined") {
      alert("MetaMask not detected!");
      return;
    }
    try {
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      const address = await signer.getAddress();
      document.getElementById("walletAddress").innerText = "Wallet: " + address;

      stakingContract = new ethers.Contract(STAKING_ADDRESS, stakingAbi, signer);
      tokenContract   = new ethers.Contract(TOKEN_ADDRESS, tokenAbi, signer);

      alert("Wallet connected successfully!");
    } catch (err) {
      console.error(err);
      alert("Wallet connection failed: " + err.message);
    }
  }

  // ============ Approve ============
  async function approve() {
    try {
      const amount = document.getElementById("stakeAmount").value;
      const tx = await tokenContract.approve(STAKING_ADDRESS, ethers.utils.parseUnits(amount, 6));
      await tx.wait();
      alert("Approved " + amount + " USDT");
    } catch (err) { alert("Approve failed: " + err.message); }
  }

  // ============ Deposit ============
  async function deposit() {
    try {
      const amount = document.getElementById("stakeAmount").value;
      const tx = await stakingContract.deposit(ethers.utils.parseUnits(amount, 6), ethers.constants.AddressZero);
      await tx.wait();
      alert("Deposited " + amount + " USDT");
    } catch (err) { alert("Deposit failed: " + err.message); }
  }

  // ============ Withdraw ============
  async function withdraw() {
    try {
      const amount = document.getElementById("withdrawAmount").value;
      const tx = await stakingContract.withdrawPrincipal(ethers.utils.parseUnits(amount, 6));
      await tx.wait();
      alert("Withdrew " + amount + " USDT");
    } catch (err) { alert("Withdraw failed: " + err.message); }
  }

  // ============ Check Pending Rewards ============
  async function checkPending() {
    try {
      const address = await signer.getAddress();
      const rewards = await stakingContract.pendingRewards(address);
      document.getElementById("pendingRewards").innerText = "Rewards: " + ethers.utils.formatUnits(rewards, 6) + " USDT";
    } catch (err) { alert("Error fetching rewards: " + err.message); }
  }

  // ============ Claim Rewards ============
  async function claimRewards() {
    try {
      const tx = await stakingContract.claimRewards();
      await tx.wait();
      alert("Rewards claimed!");
    } catch (err) { alert("Claim failed: " + err.message); }
  }

  // ============ Check Staked Info ============
  async function checkStakedInfo() {
    try {
      const address = await signer.getAddress();
      const user = await stakingContract.users(address);
      const staked = ethers.utils.formatUnits(user.staked, 6);
      const rewardDebt = ethers.utils.formatUnits(user.rewardDebt, 6);
      const totalEarned = ethers.utils.formatUnits(user.totalEarned, 6);

      document.getElementById("stakedInfo").innerText =
        `Staked: ${staked} USDT | Reward Debt: ${rewardDebt} USDT | Total Earned: ${totalEarned} USDT`;
    } catch (err) {
      console.error(err);
      alert("Error fetching staked info: " + err.message);
    }
  }
</script>
</body>
</html>
