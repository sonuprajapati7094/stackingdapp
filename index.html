<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>USDT Staking â€” Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { background:#0d0d0d; color:#fff; font-family:Arial,sans-serif; text-align:center; }
    .card { background:#1a1a1a; margin:20px auto; padding:20px; border-radius:12px; max-width:400px; }
    button { background:#facc15; border:none; padding:10px 18px; border-radius:8px; cursor:pointer; font-weight:bold; margin:5px; }
    button:hover { opacity:0.85; }
    input { padding:10px; border-radius:6px; border:none; margin:5px; width:70%; }
    h2 { margin-top:0; }
    .red { background:#dc2626; color:white; }
    .green { background:#16a34a; color:white; }
  </style>
</head>
<body>
  <h1>ðŸŒ™ USDT Staking â€” Pro Dashboard</h1>
  <p id="wallet">Wallet: not connected</p>
  <button onclick="connectWallet()">ðŸ”— Connect Wallet</button>

  <div class="card">
    <h2>Approve & Stake</h2>
    <input id="stakeAmount" type="number" placeholder="Amount (USDT)">
    <button onclick="approve()">Approve</button>
    <button onclick="deposit()">Deposit</button>
  </div>

  <div class="card">
    <h2>Rewards</h2>
    <button onclick="checkPending()">Check Pending Rewards</button>
    <p id="pending">Rewards: 0 USDT</p>
    <button onclick="claim()">Claim Rewards</button>
  </div>

  <div class="card">
    <h2>Withdraw</h2>
    <input id="withdrawAmount" type="number" placeholder="Amount (USDT)">
    <button class="red" onclick="withdraw()">Withdraw</button>
  </div>

  <div class="card">
    <h2>ðŸ“Š Staking Info</h2>
    <button onclick="checkInfo()">Check Staked Balance</button>
    <p id="stakedInfo">-</p>
  </div>

  <div class="card">
    <h2>ðŸ”— Referral</h2>
    <input id="refLink" readonly style="width:90%;padding:10px;">
    <button onclick="copyRef()">Copy My Referral Link</button>
    <p style="font-size:12px;color:#aaa;">Share this link with friends to earn bonuses</p>
  </div>

  <script>
    const tokenAddress = "0xEbA5032Be8fc2d2a2fa29e134853ab6aAA12fa1C";
    const stakingAddress = "0x3aF2c75A4723b2139EB803bf5d558e7d43991D6E";

    const tokenAbi = [
      "function approve(address spender,uint256 amount) external returns (bool)",
      "function allowance(address owner,address spender) external view returns (uint256)",
      "function balanceOf(address account) external view returns (uint256)",
      "function decimals() external view returns (uint8)"
    ];

    const stakingAbi = [
      "function deposit(uint256 amount,address referrer) external",
      "function claimRewards() external",
      "function withdrawPrincipal(uint256 amount) external",
      "function pendingRewards(address userAddr) external view returns(uint256)",
      "function getUserInfo(address userAddr) external view returns(uint256,uint256,address,uint256,uint256)"
    ];

    let provider, signer, account, token, staking;

    async function connectWallet() {
      if (!window.ethereum) return alert("MetaMask not found!");
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      account = await signer.getAddress();
      document.getElementById("wallet").innerText = "Wallet: " + account;
      token = new ethers.Contract(tokenAddress, tokenAbi, signer);
      staking = new ethers.Contract(stakingAddress, stakingAbi, signer);
      // referral link generate
      const refLink = window.location.origin + window.location.pathname + "?ref=" + account;
      document.getElementById("refLink").value = refLink;
    }

    async function approve() {
      const amt = document.getElementById("stakeAmount").value;
      if (!amt) return alert("Enter amount");
      const decimals = await token.decimals();
      const amount = ethers.utils.parseUnits(amt, decimals);
      const tx = await token.approve(stakingAddress, amount);
      await tx.wait();
      alert("Approved " + amt + " USDT");
    }

    async function deposit() {
      const amt = document.getElementById("stakeAmount").value;
      if (!amt) return alert("Enter amount");
      const decimals = await token.decimals();
      const amount = ethers.utils.parseUnits(amt, decimals);

      // get ref from URL if present
      const urlParams = new URLSearchParams(window.location.search);
      const ref = urlParams.get("ref") || "0x0000000000000000000000000000000000000000";

      const tx = await staking.deposit(amount, ref);
      await tx.wait();
      alert("Deposited " + amt + " USDT");
    }

    async function checkPending() {
      const reward = await staking.pendingRewards(account);
      const decimals = await token.decimals();
      document.getElementById("pending").innerText =
        "Rewards: " + ethers.utils.formatUnits(reward, decimals) + " USDT";
    }

    async function claim() {
      const tx = await staking.claimRewards();
      await tx.wait();
      alert("Rewards claimed!");
      checkPending();
    }

    async function withdraw() {
      const amt = document.getElementById("withdrawAmount").value;
      if (!amt) return alert("Enter amount");
      const decimals = await token.decimals();
      const amount = ethers.utils.parseUnits(amt, decimals);
      const tx = await staking.withdrawPrincipal(amount);
      await tx.wait();
      alert("Withdraw success");
    }

    async function checkInfo() {
      const info = await staking.getUserInfo(account);
      const decimals = await token.decimals();
      const staked = ethers.utils.formatUnits(info[0], decimals);
      const earned = ethers.utils.formatUnits(info[3], decimals);
      const pending = ethers.utils.formatUnits(info[4], decimals);
      document.getElementById("stakedInfo").innerText =
        "Staked: " + staked + " USDT | Earned: " + earned + " USDT | Pending: " + pending + " USDT";
    }

    function copyRef() {
      const copyText = document.getElementById("refLink");
      copyText.select();
      document.execCommand("copy");
      alert("Referral link copied!");
    }
  </script>
</body>
</html>
