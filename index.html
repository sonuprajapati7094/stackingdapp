<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸš€ USDT Staking â€” Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#fff; margin:0; padding:0; }
    h1 { text-align:center; color:#ffd700; margin:20px 0; }
    .container { width:90%; max-width:900px; margin:auto; }
    .card { background:#1c1c1c; padding:20px; margin:15px 0; border-radius:10px; }
    .card h2 { margin-top:0; color:#ffd700; }
    .row { display:flex; justify-content:space-between; align-items:center; margin:10px 0; }
    button { padding:8px 16px; border:none; border-radius:6px; cursor:pointer; }
    .primary { background:#ffd700; color:#000; font-weight:bold; }
    .secondary { background:#333; color:#fff; }
    input { padding:8px; border-radius:6px; border:none; width:60%; }
    .walletBox { display:flex; gap:10px; align-items:center; }
    .income-box { display:flex; justify-content:space-between; }
    .income-card { background:#222; padding:15px; border-radius:8px; flex:1; margin:5px; text-align:center; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th,td { border:1px solid #444; padding:8px; text-align:center; }
    th { background:#222; color:#ffd700; }
    .highlight { color:#ffd700; }
  </style>
</head>
<body>
  <h1>ðŸš€ USDT Staking â€” Dashboard</h1>
  <div class="container">

    <!-- Wallet Section -->
    <div class="card">
      <div class="walletBox">
        <button id="connectButton" class="primary">Connect Wallet</button>
        <span id="walletAddress">Wallet: Not Connected</span>
      </div>
    </div>

    <!-- Stake -->
    <div class="card">
      <h2>Stake USDT</h2>
      <input type="number" id="stakeAmount" placeholder="Amount (min 20, multiples of 20)">
      <button id="approveButton" class="secondary">Quick Approve</button>
      <button id="stakeButton" class="primary">Stake</button>
      <p id="walletBalanceText">Wallet Balance: 0 USDT</p>
    </div>

    <!-- Referral -->
    <div class="card">
      <h2>Your referral link</h2>
      <div class="walletBox">
        <input id="refLink" readonly>
        <button onclick="copyReferral()" class="primary">Copy</button>
      </div>
      <small>Share this link â€” only users who join using a referral link will be accepted (if contract enforces it).</small>
    </div>

    <!-- Incomes -->
    <div class="card">
      <h2>Income Wallets</h2>
      <div class="income-box">
        <div class="income-card"><div>Instant income</div><div id="instantIncome">0 USDT</div></div>
        <div class="income-card"><div>Level income</div><div id="levelIncome">0 USDT</div></div>
        <div class="income-card"><div>ROI income</div><div id="roiIncome">0 USDT</div></div>
        <div class="income-card"><div class="highlight">Total Wallet</div><div id="totalWallet">0 USDT</div></div>
      </div>
    </div>

    <!-- Withdraw -->
    <div class="card">
      <h2>Withdraw</h2>
      <input type="number" id="withdrawAmount" placeholder="Amount (min 10, multiples of 10)">
      <button id="withdrawButton" class="primary">Request Withdraw</button>
      <h3>Withdrawal History</h3>
      <div id="withdrawHistory">No withdrawals yet.</div>
    </div>

    <!-- Staking Info -->
    <div class="card">
      <h2>Staking Info</h2>
      <p>Staked: <span id="stakedAmount">0 USDT</span></p>
      <p>Target (3x): <span id="targetAmount">0 USDT</span></p>
      <p>Days to 3x: <span id="daysTo3x">0 days</span></p>
      <p>Package Status: <span id="packageStatus">Inactive</span></p>
    </div>

    <!-- Team Info -->
    <div class="card">
      <h2>Team Info</h2>
      <p>Direct: <span id="directCount">0</span></p>
      <p>Indirect: <span id="indirectCount">0</span></p>
    </div>

    <!-- Level Structure -->
    <div class="card">
      <h2>Level Structure</h2>
      <table>
        <thead><tr><th>Level</th><th>Percent</th><th>Status</th></tr></thead>
        <tbody>
          <tr><td>L1</td><td>10%</td><td id="L1">Pending</td></tr>
          <tr><td>L2</td><td>10%</td><td id="L2">Pending</td></tr>
          <tr><td>L3</td><td>5%</td><td id="L3">Pending</td></tr>
          <tr><td>L4</td><td>3%</td><td id="L4">Pending</td></tr>
          <tr><td>L5</td><td>2%</td><td id="L5">Pending</td></tr>
          <tr><td>L6</td><td>1%</td><td id="L6">Pending</td></tr>
          <tr><td>L7</td><td>1%</td><td id="L7">Pending</td></tr>
          <tr><td>L8</td><td>1%</td><td id="L8">Pending</td></tr>
          <tr><td>L9</td><td>1%</td><td id="L9">Pending</td></tr>
          <tr><td>L10</td><td>1%</td><td id="L10">Pending</td></tr>
        </tbody>
      </table>
    </div>

  </div>

<script>
let provider, signer, account, contract, tokenContract;

const contractAddress = "0x3aF2c75A4723b2139EB803bf5d558e7d43991D6E"; 
const tokenAddress    = "0xEbA5032Be8fc2d2a2fa29e134853ab6aAA12fa1C"; 

// ========== Contract ABI (shortened example, paste full ABI here) ==========
const abi = [ /* staking contract ABI here */ ];
const tokenAbi = [ /* ERC20 ABI here */ ];

// connect wallet
async function connectWallet() {
  try {
    await ethereum.request({ method: "eth_requestAccounts" });
    provider = new ethers.providers.Web3Provider(window.ethereum);
    signer = provider.getSigner();
    account = await signer.getAddress();
    contract = new ethers.Contract(contractAddress, abi, signer);
    tokenContract = new ethers.Contract(tokenAddress, tokenAbi, signer);
    document.getElementById("walletAddress").innerText = "Wallet: " + account;
    document.getElementById("connectButton").innerText = account.substring(0,6)+"..."+account.slice(-4);
    await refreshAll();
  } catch (err) {
    alert("Wallet connect failed: " + err.message);
  }
}

// auto reconnect
async function checkConnectionOnLoad() {
  if (typeof window.ethereum !== "undefined") {
    const accounts = await ethereum.request({ method: "eth_accounts" });
    if (accounts.length > 0) {
      connectWallet();
    }
  }
}
window.addEventListener("load", checkConnectionOnLoad);

// copy referral
function copyReferral() {
  let ref = document.getElementById("refLink");
  ref.select();
  ref.setSelectionRange(0, 99999);
  navigator.clipboard.writeText(ref.value);
  alert("Referral link copied!");
}

// load wallet balance
async function loadWalletBalance() {
  if (!account) return;
  try {
    let bal = await tokenContract.balanceOf(account);
    bal = ethers.utils.formatUnits(bal, 6);
    document.getElementById("walletBalanceText").innerText = "Wallet Balance: " + bal + " USDT";
  } catch (e) { console.error(e); }
}

// refresh dashboard
async function refreshAll() {
  if (!account) return;
  await loadWalletBalance();
  // TODO: fetch incomes, staked, team info etc from contract
}
</script>
</body>
</html>
