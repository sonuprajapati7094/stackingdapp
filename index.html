<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸŒ‘ USDT Staking â€” Pro Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <style>
    body { background:#0d0d0d; color:white; font-family:Arial; text-align:center; }
    .card { background:#1a1a1a; padding:20px; margin:20px auto; width:400px; border-radius:12px; }
    button { padding:10px 15px; margin:5px; border:none; border-radius:6px; cursor:pointer; }
    .primary { background:#facc15; color:black; font-weight:bold; }
    .secondary { background:#333; color:white; }
    .danger { background:#ef4444; color:white; }
    input { padding:8px; margin:5px; border-radius:6px; border:none; width:80%; }
    .info { margin-top:10px; padding:10px; background:#111; border-radius:6px; font-size:14px; text-align:left; }
  </style>
</head>
<body>
  <h1>ðŸŒ‘ USDT Staking â€” Pro Dashboard</h1>
  <button id="connectBtn" class="primary">ðŸ”— Connect Wallet</button>
  <p id="walletAddress">Wallet: not connected</p>

  <div class="card">
    <h3>Approve & Stake</h3>
    <input type="number" id="stakeAmount" placeholder="Amount (USDT)">
    <button onclick="approve()" class="secondary">Approve</button>
    <button onclick="deposit()" class="primary">Deposit</button>
  </div>

  <div class="card">
    <h3>Rewards</h3>
    <button onclick="checkPending()" class="secondary">Check Pending Rewards</button>
    <p id="pending">Rewards: 0 USDT</p>
    <button onclick="claim()" class="primary">Claim Rewards</button>
  </div>

  <div class="card">
    <h3>Withdraw</h3>
    <input type="number" id="withdrawAmount" placeholder="Amount (USDT)">
    <button onclick="withdraw()" class="danger">Withdraw</button>
  </div>

  <div class="card">
    <h3>ðŸ“Š Staking Info</h3>
    <button onclick="checkStaked()" class="secondary">Check Staked Balance</button>
    <div id="staked" class="info">-</div>
  </div>

  <script>
    // ------------ CONFIG ------------
    const STAKING_ADDRESS = "0x20Fbd4AF3cB507e702C7C513F08D7857bAc74407";
    const TOKEN_ADDRESS   = "0xEbA5032Be8fc2d2a2fa29e134853ab6aAA12fa1C";

    const stakingAbi = [
      {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"address","name":"referrer","type":"address"}],"name":"deposit","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[],"name":"claimRewards","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdrawPrincipal","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"address","name":"userAddr","type":"address"}],"name":"pendingRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"userAddr","type":"address"}],"name":"getUserInfo","outputs":[
        {"internalType":"uint256","name":"staked","type":"uint256"},
        {"internalType":"uint256","name":"lastAction","type":"uint256"},
        {"internalType":"address","name":"referrer","type":"address"},
        {"internalType":"uint256","name":"totalEarned","type":"uint256"},
        {"internalType":"uint256","name":"pending","type":"uint256"}
      ],"stateMutability":"view","type":"function"}
    ];

    const tokenAbi = [
      {"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"type":"function"},
      {"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"type":"function"}
    ];

    let provider, signer, stakingContract, tokenContract, userAddress;

    document.getElementById("connectBtn").onclick = async () => {
      if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        userAddress = await signer.getAddress();
        document.getElementById("walletAddress").innerText = "Wallet: " + userAddress;
        stakingContract = new ethers.Contract(STAKING_ADDRESS, stakingAbi, signer);
        tokenContract = new ethers.Contract(TOKEN_ADDRESS, tokenAbi, signer);
      } else {
        alert("Install MetaMask!");
      }
    };

    async function approve() {
      const amt = document.getElementById("stakeAmount").value;
      const amount = ethers.utils.parseUnits(amt, 6);
      const tx = await tokenContract.approve(STAKING_ADDRESS, amount);
      await tx.wait();
      alert("Approved " + amt + " USDT");
    }

    async function deposit() {
      const amt = document.getElementById("stakeAmount").value;
      const amount = ethers.utils.parseUnits(amt, 6);
      const tx = await stakingContract.deposit(amount, "0x0000000000000000000000000000000000000000");
      await tx.wait();
      alert("Deposited " + amt + " USDT");
    }

    async function checkPending() {
      const reward = await stakingContract.pendingRewards(userAddress);
      document.getElementById("pending").innerText =
        "Rewards: " + ethers.utils.formatUnits(reward, 6) + " USDT";
    }

    async function claim() {
      const tx = await stakingContract.claimRewards();
      await tx.wait();
      alert("Rewards Claimed!");
    }

    async function withdraw() {
      const amt = document.getElementById("withdrawAmount").value;
      const amount = ethers.utils.parseUnits(amt, 6);
      const tx = await stakingContract.withdrawPrincipal(amount);
      await tx.wait();
      alert("Withdrawn " + amt + " USDT");
    }

    async function checkStaked() {
      const info = await stakingContract.getUserInfo(userAddress);
      const stakedAmount = info[0];
      const lastAction = info[1];
      const referrer = info[2];
      const totalEarned = info[3];
      const pending = info[4];

      document.getElementById("staked").innerText =
        "Staked: " + ethers.utils.formatUnits(stakedAmount, 6) + " USDT\n" +
        "Total Earned: " + ethers.utils.formatUnits(totalEarned, 6) + " USDT\n" +
        "Pending: " + ethers.utils.formatUnits(pending, 6) + " USDT\n" +
        "Referrer: " + referrer + "\n" +
        "Last Action: " + (lastAction > 0 ? new Date(lastAction * 1000).toLocaleString() : "N/A");
    }
  </script>
</body>
</html>
