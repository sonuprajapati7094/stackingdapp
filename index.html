<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>USDT Staking â€” Pro Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      margin: 20px 0;
    }
    .container {
      margin: 20px auto;
      max-width: 500px;
      background: #1e1e1e;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0px 0px 10px rgba(255, 255, 255, 0.1);
    }
    button {
      margin: 8px;
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    .btn-yellow { background: #facc15; color: #000; }
    .btn-red { background: #ef4444; color: #fff; }
    .btn-dark { background: #333; color: #fff; }
    input {
      padding: 10px;
      margin: 8px;
      border-radius: 6px;
      border: none;
      width: 70%;
    }
    .section-title {
      font-weight: bold;
      margin-top: 15px;
    }
    .info {
      margin: 10px 0;
      font-size: 14px;
    }
  </style>
  <!-- âœ… FIXED CDN LINK -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
</head>
<body>

  <h1>ðŸŒ• USDT Staking â€” Pro Dashboard</h1>

  <button id="connectWallet" class="btn-yellow">ðŸ”— Connect Wallet</button>
  <p id="walletAddress">Wallet: not connected</p>

  <div class="container">
    <div class="section-title">Approve & Stake</div>
    <input type="number" id="stakeAmount" placeholder="Amount (USDT)">
    <button id="approveBtn" class="btn-dark">Approve</button>
    <button id="depositBtn" class="btn-yellow">Deposit</button>
  </div>

  <div class="container">
    <div class="section-title">Rewards</div>
    <button id="checkRewards" class="btn-dark">Check Pending Rewards</button>
    <p id="rewards">Rewards: 0 USDT</p>
    <button id="claimBtn" class="btn-yellow">Claim Rewards</button>
  </div>

  <div class="container">
    <div class="section-title">Withdraw</div>
    <input type="number" id="withdrawAmount" placeholder="Amount (USDT)">
    <button id="withdrawBtn" class="btn-red">Withdraw</button>
  </div>

  <div class="container">
    <div class="section-title">ðŸ“Š Staking Info</div>
    <button id="checkStaked" class="btn-dark">Check Staked Balance</button>
    <p id="stakedInfo">Staked: - USDT <br> Target (3x cap): - USDT <br> Days to reach 3x: -</p>
  </div>

  <script>
    // âœ… Replace with your deployed addresses
    const STAKING_ADDRESS = "0x20Fbd4AF3cB507e702C7C513F08D7857bAc74407";
    const TOKEN_ADDRESS   = "0xEbA5032Be8fc2d2a2fa29e134853ab6aAA12fa1C";

    // âœ… Token ABI (simplified ERC20)
    const tokenAbi = [
      "function approve(address spender, uint256 amount) public returns (bool)",
      "function allowance(address owner, address spender) public view returns (uint256)",
      "function balanceOf(address account) public view returns (uint256)",
      "function decimals() public view returns (uint8)"
    ];

    // âœ… Staking Contract ABI (important functions only)
    const stakingAbi = [
      "function deposit(uint256 amount, address referrer) public",
      "function claimRewards() public",
      "function withdrawPrincipal(uint256 amount) public",
      "function pendingRewards(address userAddr) public view returns (uint256)",
      "function users(address userAddr) public view returns (uint256 staked, uint256 rewardDebt, uint256 lastAction, address referrer, uint256 totalEarned)"
    ];

    let provider, signer, tokenContract, stakingContract;

    document.getElementById("connectWallet").onclick = async () => {
      if (typeof window.ethereum !== "undefined") {
        try {
          await ethereum.request({ method: "eth_requestAccounts" });
          provider = new ethers.providers.Web3Provider(window.ethereum);
          signer = provider.getSigner();
          const address = await signer.getAddress();
          document.getElementById("walletAddress").innerText = "Wallet: " + address;

          tokenContract = new ethers.Contract(TOKEN_ADDRESS, tokenAbi, signer);
          stakingContract = new ethers.Contract(STAKING_ADDRESS, stakingAbi, signer);

          alert("âœ… Wallet connected successfully!");
        } catch (err) {
          alert("Wallet connection failed: " + err.message);
        }
      } else {
        alert("MetaMask not found. Please install it.");
      }
    };

    // Approve
    document.getElementById("approveBtn").onclick = async () => {
      const amount = document.getElementById("stakeAmount").value;
      if (!amount) return alert("Enter amount");
      const decimals = await tokenContract.decimals();
      const amt = ethers.utils.parseUnits(amount, decimals);
      await tokenContract.approve(STAKING_ADDRESS, amt);
      alert("âœ… Approved " + amount + " USDT");
    };

    // Deposit
    document.getElementById("depositBtn").onclick = async () => {
      const amount = document.getElementById("stakeAmount").value;
      if (!amount) return alert("Enter amount");
      const decimals = await tokenContract.decimals();
      const amt = ethers.utils.parseUnits(amount, decimals);
      await stakingContract.deposit(amt, ethers.constants.AddressZero);
      alert("âœ… Deposited " + amount + " USDT");
    };

    // Check Rewards
    document.getElementById("checkRewards").onclick = async () => {
      const address = await signer.getAddress();
      const reward = await stakingContract.pendingRewards(address);
      const decimals = await tokenContract.decimals();
      document.getElementById("rewards").innerText =
        "Rewards: " + ethers.utils.formatUnits(reward, decimals) + " USDT";
    };

    // Claim Rewards
    document.getElementById("claimBtn").onclick = async () => {
      await stakingContract.claimRewards();
      alert("âœ… Rewards claimed!");
    };

    // Withdraw
    document.getElementById("withdrawBtn").onclick = async () => {
      const amount = document.getElementById("withdrawAmount").value;
      if (!amount) return alert("Enter amount");
      const decimals = await tokenContract.decimals();
      const amt = ethers.utils.parseUnits(amount, decimals);
      await stakingContract.withdrawPrincipal(amt);
      alert("âœ… Withdrawn " + amount + " USDT");
    };

    // Check Staked Info
    document.getElementById("checkStaked").onclick = async () => {
      const address = await signer.getAddress();
      const user = await stakingContract.users(address);
      const decimals = await tokenContract.decimals();
      const staked = ethers.utils.formatUnits(user.staked, decimals);
      const target = (parseFloat(staked) * 3).toFixed(2);
      const days = Math.ceil((target - staked) / (0.18 * staked / 365)); // approx calc
      document.getElementById("stakedInfo").innerHTML =
        "Staked: " + staked + " USDT<br>" +
        "Target (3x cap): " + target + " USDT<br>" +
        "Days to reach 3x: " + (days > 0 ? days : "-");
    };
  </script>
</body>
</html>
