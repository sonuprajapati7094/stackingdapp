<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>USDT Staking dApp</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
</head>
<body>
  <h1>USDT Staking Platform</h1>
  <button id="connectBtn">Connect Wallet</button>
  <p id="walletAddress">Wallet: Not Connected</p>

  <h3>Your Balance</h3>
  <button onclick="checkBalance()">Check Balance</button>
  <p id="balance"></p>

  <h3>Stake USDT</h3>
  <input type="number" id="stakeAmount" placeholder="Amount (USDT)">
  <button onclick="approve()">Approve</button>
  <button onclick="deposit()">Deposit</button>

  <h3>Rewards</h3>
  <button onclick="checkPending()">Check Pending Rewards</button>
  <p id="pending"></p>
  <button onclick="claim()">Claim Rewards</button>

  <h3>Staked Info</h3>
  <button onclick="checkStaked()">Check Staked Info</button>
  <pre id="staked"></pre>

  <script>
    // ---------------- CONFIG ----------------
    const STAKING_ADDRESS = "0x20Fbd4AF3cB507e702C7C513F08D7857bAc74407";
    const TOKEN_ADDRESS   = "0xEbA5032Be8fc2d2a2fa29e134853ab6aAA12fa1C";

    const stakingAbi = [
      {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"address","name":"referrer","type":"address"}],"name":"deposit","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[],"name":"claimRewards","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdrawPrincipal","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"address","name":"userAddr","type":"address"}],"name":"pendingRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"userAddr","type":"address"}],"name":"getUserInfo","outputs":[{"internalType":"uint256","name":"staked","type":"uint256"},{"internalType":"uint256","name":"lastAction","type":"uint256"},{"internalType":"address","name":"referrer","type":"address"},{"internalType":"uint256","name":"totalEarned","type":"uint256"},{"internalType":"uint256","name":"pending","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"token","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"totalStaked","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"totalRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"roiBP","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"lockSeconds","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"minTx","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"capX","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
    ];

    const tokenAbi = [
      {"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"type":"function"},
      {"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"type":"function"},
      {"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"","type":"bool"}],"type":"function"},
      {"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"type":"function"},
      {"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"type":"function"},
      {"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"type":"function"},
      {"constant":true,"inputs":[{"name":"owner","type":"address"},{"name":"spender","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"type":"function"}
    ];

    let provider, signer, stakingContract, tokenContract, userAddress;

    document.getElementById("connectBtn").onclick = async () => {
      if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        userAddress = await signer.getAddress();
        document.getElementById("walletAddress").innerText = "Wallet: " + userAddress;
        stakingContract = new ethers.Contract(STAKING_ADDRESS, stakingAbi, signer);
        tokenContract = new ethers.Contract(TOKEN_ADDRESS, tokenAbi, signer);
      } else {
        alert("Install MetaMask!");
      }
    };

    async function checkBalance() {
      const bal = await tokenContract.balanceOf(userAddress);
      document.getElementById("balance").innerText =
        "Balance: " + ethers.utils.formatUnits(bal, 6) + " USDT";
    }

    async function approve() {
      const amt = document.getElementById("stakeAmount").value;
      const amount = ethers.utils.parseUnits(amt, 6);
      const tx = await tokenContract.approve(STAKING_ADDRESS, amount);
      await tx.wait();
      alert("Approved " + amt + " USDT");
    }

    async function deposit() {
      const amt = document.getElementById("stakeAmount").value;
      const amount = ethers.utils.parseUnits(amt, 6);
      const tx = await stakingContract.deposit(amount, "0x0000000000000000000000000000000000000000");
      await tx.wait();
      alert("Deposited " + amt + " USDT");
    }

    async function checkPending() {
      const reward = await stakingContract.pendingRewards(userAddress);
      document.getElementById("pending").innerText =
        "Pending Rewards: " + ethers.utils.formatUnits(reward, 6) + " USDT";
    }

    async function claim() {
      const tx = await stakingContract.claimRewards();
      await tx.wait();
      alert("Rewards Claimed!");
    }

    async function checkStaked() {
      const info = await stakingContract.getUserInfo(userAddress);
      const stakedAmount = info[0];
      const lastAction = info[1];
      const referrer = info[2];
      const totalEarned = info[3];
      const pending = info[4];

      document.getElementById("staked").innerText =
        "Staked: " + ethers.utils.formatUnits(stakedAmount, 6) + " USDT\n" +
        "Total Earned: " + ethers.utils.formatUnits(totalEarned, 6) + " USDT\n" +
        "Pending: " + ethers.utils.formatUnits(pending, 6) + " USDT\n" +
        "Referrer: " + referrer + "\n" +
        "Last Action: " + (lastAction > 0 ? new Date(lastAction * 1000).toLocaleString() : "N/A");
    }
  </script>
</body>
</html>
