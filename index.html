<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>USDT Staking Dashboard</title>

  <!-- ethers v5 -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <style>
    :root {
      --bg: #0b0d0f; --card: #121416; --muted: #9aa4b2; --accent: #ffd86b; --panel: #0f1113;
      --glow: rgba(255, 216, 107, 0.4);
    }
    body { margin:0; font-family: Inter, Arial, sans-serif; background:var(--bg); color:#e6eef6; }
    header { padding:18px 24px; text-align:center; background:linear-gradient(90deg,#081018, #0d1016); box-shadow:0 2px 8px rgba(0,0,0,0.5); }
    header h1 { margin:0; color:var(--accent); font-size:20px; letter-spacing:0.6px; }
    .topbar { display:flex; justify-content:flex-end; gap:12px; padding:12px 24px; align-items:center; }
    .wallet-btn { background:var(--accent); color:#000; padding:8px 14px; border-radius:8px; border:0; font-weight:600; cursor:pointer; }
    .container { padding: 20px; display:grid; grid-template-columns: 360px 1fr; gap:18px; max-width:1180px; margin:18px auto; }
    .left { display:flex; flex-direction:column; gap:14px; }
    .card { background:var(--card); border-radius:12px; padding:14px; box-shadow: 0 6px 20px rgba(0,0,0,0.4); }
    .card h2 { margin:0 0 10px 0; color:var(--accent); font-size:16px; }
    .muted { color:var(--muted); font-size:13px; }
    input[type="number"], input[type="text"] { width:100%; padding:10px 12px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:var(--panel); color:#fff; }
    .small-btn, .accent-btn { border-radius:8px; border:0; cursor:pointer; padding:10px 12px; font-weight:600; }
    .small-btn { background:#2a2f35; color:#fff; margin-top:8px; }
    .accent-btn { background:var(--accent); color:#000; font-weight:700; margin-top:8px; }
    .right { display:flex; flex-direction:column; gap:14px; }
    .grid-4 { display:grid; grid-template-columns:repeat(4,1fr); gap:12px; }
    .value { font-size:18px; font-weight:700; color:#fff; }
    .label { font-size:12px; color:var(--muted); margin-top:6px; }
    table { width:100%; border-collapse:collapse; margin-top:8px; font-size:13px; }
    th,td { padding:10px 8px; border-bottom:1px solid rgba(255,255,255,0.03); text-align:left; }
    th { color:var(--accent); font-weight:700; background:transparent; }
    .center { text-align:center; }
    .sm { font-size:12px; color:var(--muted); }
    footer { padding:14px; text-align:center; color:var(--muted); font-size:12px; }
    @media(max-width:980px) {
      .container { grid-template-columns: 1fr; padding:12px; }
      .grid-4 { grid-template-columns: repeat(2,1fr); }
    }

    /* ===== Progress Bar Styles ===== */
    .progress-container {
      width: 100%;
      background: #1d1f23;
      border-radius: 8px;
      height: 16px;
      margin-top: 10px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), #ffe28a, #fff3c2);
      width: 0%;
      border-radius: 8px;
      box-shadow: 0 0 8px var(--glow);
      transition: width 1s ease;
    }
    .progress-label {
      font-size: 12px;
      margin-top: 4px;
      color: var(--muted);
      text-align: right;
    }
  </style>
</head>

<body>
  <header><h1>USDT Staking ‚Äî Dashboard</h1></header>

  <div class="topbar" style="max-width:1180px;margin:0 auto">
    <div id="walletDisplay" class="sm muted">Not connected</div>
    <button id="connectBtn" class="wallet-btn">Connect Wallet</button>
  </div>

  <main class="container">
    <div class="left">
      <div class="card">
        <h2>Stake USDT</h2>
        <div class="sm muted">Minimum deposit: 20 USDT ‚Äî multiples of 20 only</div>
        <input id="stakeAmount" type="number" placeholder="20, 40, 60 ..." />
        <button class="accent-btn" id="quickApproveBtn">Quick Approve</button>
        <button class="accent-btn" id="stakeBtn">Stake Now</button>
      </div>
    </div>

    <div class="right">
      <div class="card">
        <h2>Staking Info</h2>
        <table>
          <tr><th>Metric</th><th>Value</th></tr>
          <tr><td>Staked</td><td id="stakedDisplay">0.000000 USDT</td></tr>
          <tr><td>Target (3x)</td><td id="targetDisplay">0.000000 USDT</td></tr>
          <tr><td>Days to 3x</td><td id="days3x">0 days</td></tr>
          <tr><td>Package Status</td><td id="pkgStatus">Inactive</td></tr>
        </table>

        <!-- üî• New Progress Visual -->
        <div class="progress-container">
          <div id="roiProgress" class="progress-bar"></div>
        </div>
        <div class="progress-label" id="roiProgressLabel">0% progress to 3x goal</div>
      </div>
    </div>
  </main>

  <footer>Made with ‚ù§Ô∏è ‚Äî (1% daily | 3x in 300 Days)</footer>

<script>
/* ==================== CONFIG ==================== */
const STAKING_ADDRESS = "0x872C20bA980b9e31e5De6311Dc7d12e153c467C3"; // replace
const TOKEN_ADDRESS   = "0xBCE19c66E53da172F78FE800368361a8aaB51F2a"; // replace
let TOKEN_DECIMALS = 6;

let provider, signer, stakingContract, tokenContract, account;
const dailyRate = 0.01;  // 1% daily
const MAX_DAYS = 300;    // 3x in 300 days

/* ==================== Connect Wallet ==================== */
async function connect() {
  if (!window.ethereum) return alert("MetaMask not detected");
  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = provider.getSigner();
  account = await signer.getAddress();
  document.getElementById("walletDisplay").innerText = account;

  const stakingABI = [
    "function getUserInfo(address) view returns (uint256 staked,uint256 lastAction,address referrer,uint256 totalEarned,uint256 pending,uint256 incomeBal)"
  ];
  const tokenABI = ["function decimals() view returns (uint8)"];
  
  stakingContract = new ethers.Contract(STAKING_ADDRESS, stakingABI, signer);
  tokenContract = new ethers.Contract(TOKEN_ADDRESS, tokenABI, signer);
  try { TOKEN_DECIMALS = await tokenContract.decimals(); } catch {}
  
  await loadUserData();
}

/* ==================== Load On-Chain Data ==================== */
async function loadUserData() {
  const info = await stakingContract.getUserInfo(account);
  const staked = Number(ethers.utils.formatUnits(info.staked, TOKEN_DECIMALS));
  const earned = Number(ethers.utils.formatUnits(info.totalEarned, TOKEN_DECIMALS)) + Number(ethers.utils.formatUnits(info.incomeBal, TOKEN_DECIMALS));
  const pending = Number(ethers.utils.formatUnits(info.pending, TOKEN_DECIMALS));
  const totalEarn = earned + pending;

  document.getElementById("stakedDisplay").innerText = staked.toFixed(2) + " USDT";
  document.getElementById("targetDisplay").innerText = (staked * 3).toFixed(2) + " USDT";
  document.getElementById("pkgStatus").innerText = staked > 0 ? "Active" : "Inactive";

  // Days to 3x (using 1% daily)
  const dailyReward = staked * dailyRate;
  const remaining = Math.max(staked * 3 - totalEarn, 0);
  const daysTo3x = dailyReward > 0 ? Math.ceil(remaining / dailyReward) : 0;
  document.getElementById("days3x").innerText = (daysTo3x > 0 ? daysTo3x : 0) + " days";

  // Update visual progress
  updateProgress(staked, totalEarn);
}

/* ==================== Progress Bar Animation ==================== */
function updateProgress(staked, earned) {
  if (staked <= 0) {
    document.getElementById("roiProgress").style.width = "0%";
    document.getElementById("roiProgressLabel").innerText = "No active stake yet";
    return;
  }
  const percent = Math.min((earned / (staked * 3)) * 100, 100);
  document.getElementById("roiProgress").style.width = percent.toFixed(2) + "%";
  document.getElementById("roiProgressLabel").innerText = `${percent.toFixed(1)}% progress to 3x`;
}

/* ==================== Auto Refresh ==================== */
setInterval(() => {
  if (stakingContract && account) loadUserData();
}, 30000);

document.getElementById("connectBtn").addEventListener("click", connect);
</script>
</body>
</html>
