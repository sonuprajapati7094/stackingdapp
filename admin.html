<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Admin Panel ‚Äî USDT Staking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Ethers v5 -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body{background:#0c0c0f;color:#fff;font-family:Inter,system-ui,Arial;margin:0;padding:30px;display:flex;flex-direction:column;align-items:center}
    h1{margin:0 0 20px;font-size:26px}
    .card{background:#18181b;padding:20px;border-radius:12px;margin:14px 0;box-shadow:0 6px 20px rgba(0,0,0,0.45);width:500px;max-width:95%}
    button{cursor:pointer;border:0;padding:10px 16px;border-radius:8px;font-weight:600}
    .btn-yellow{background:#ffc629;color:#111}
    .btn-dark{background:#2a2a2e;color:#fff}
    input{padding:10px;border-radius:8px;border:0;background:#2a2a2e;color:#fff;width:180px}
    .muted{color:#aaa;font-size:14px}
  </style>
</head>
<body>
  <h1>‚öôÔ∏è Admin Panel ‚Äî USDT Staking</h1>
  <div id="walletText" class="muted">Wallet: not connected</div>
  <div style="margin:16px"><button id="connectBtn" class="btn-yellow">Connect Wallet</button></div>

  <div class="card">
    <h3>üìä Contract Stats</h3>
    <div id="stats">-</div>
    <button class="btn-dark" id="refreshBtn">Refresh Stats</button>
  </div>

  <div class="card">
    <h3>üîß Update Parameters</h3>
    <div class="muted">ROI (basis points), Lock (sec), MinTx (USDT), CapX</div>
    <input id="roiInput" placeholder="ROI BP (e.g. 1800)" /><br><br>
    <input id="lockInput" placeholder="Lock (sec)" /><br><br>
    <input id="minTxInput" placeholder="MinTx (USDT)" /><br><br>
    <input id="capXInput" placeholder="CapX (e.g. 3)" /><br><br>
    <button class="btn-yellow" id="setParamsBtn">Update Params</button>
  </div>

  <div class="card">
    <h3>üö® Emergency Withdraw</h3>
    <input id="toInput" placeholder="To address" /><br><br>
    <input id="amtInput" placeholder="Amount (USDT)" /><br><br>
    <button class="btn-dark" id="emergencyBtn">Withdraw</button>
  </div>

  <div class="card">
    <h3>üëë Ownership</h3>
    <input id="newOwnerInput" placeholder="New Owner Address" /><br><br>
    <button class="btn-yellow" id="transferBtn">Transfer Ownership</button>
  </div>

<script>
(async function(){
  const STAKING_ADDRESS = "0x20Fbd4AF3cB507e702C7C513F08D7857bAc74407"; 
  const TOKEN_ADDRESS   = "0xEbA5032Be8fc2d2a2fa29e134853ab6aAA12fa1C"; 

  const stakingAbi = [
    "function owner() view returns (address)",
    "function roiBP() view returns (uint256)",
    "function lockSeconds() view returns (uint256)",
    "function minTx() view returns (uint256)",
    "function capX() view returns (uint256)",
    "function totalStaked() view returns (uint256)",
    "function totalRewards() view returns (uint256)",
    "function setParams(uint256,uint256,uint256,uint256)",
    "function emergencyWithdraw(address,uint256)",
    "function transferOwnership(address)"
  ];

  const tokenAbi = [
    "function decimals() view returns (uint8)"
  ];

  let provider, signer, userAddress, staking, token, decimals=6, contractOwner;

  const connectBtn=document.getElementById("connectBtn");
  const walletText=document.getElementById("walletText");
  const refreshBtn=document.getElementById("refreshBtn");
  const stats=document.getElementById("stats");

  async function connect(){
    provider=new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    signer=provider.getSigner();
    userAddress=await signer.getAddress();
    staking=new ethers.Contract(STAKING_ADDRESS, stakingAbi, signer);
    token=new ethers.Contract(TOKEN_ADDRESS, tokenAbi, signer);
    decimals=await token.decimals();
    contractOwner=await staking.owner();

    walletText.textContent="Wallet: "+userAddress+(userAddress.toLowerCase()==contractOwner.toLowerCase()?" (OWNER)":" (User)");
    connectBtn.textContent="Connected";
  }
  connectBtn.onclick=connect;

  function fmt(bn){return ethers.utils.formatUnits(bn,decimals);}
  function toUnits(v){return ethers.utils.parseUnits(v||"0",decimals);}

  refreshBtn.onclick=async()=>{
    const roi=await staking.roiBP();
    const lock=await staking.lockSeconds();
    const minTx=await staking.minTx();
    const cap=await staking.capX();
    const totalSt=await staking.totalStaked();
    const totalRw=await staking.totalRewards();
    stats.innerHTML=`
      Owner: ${contractOwner}<br>
      ROI: ${roi} BP (~${roi/100}%/yr)<br>
      Lock: ${lock} sec<br>
      MinTx: ${fmt(minTx)} USDT<br>
      CapX: ${cap}x<br>
      Total Staked: ${fmt(totalSt)} USDT<br>
      Total Rewards: ${fmt(totalRw)} USDT
    `;
  };

  document.getElementById("setParamsBtn").onclick=async()=>{
    if(userAddress.toLowerCase()!=contractOwner.toLowerCase()){alert("Not owner!");return;}
    const roi=document.getElementById("roiInput").value;
    const lock=document.getElementById("lockInput").value;
    const minTx=toUnits(document.getElementById("minTxInput").value);
    const cap=document.getElementById("capXInput").value;
    const tx=await staking.setParams(roi,lock,minTx,cap);
    await tx.wait();
    alert("Params updated");
  };

  document.getElementById("emergencyBtn").onclick=async()=>{
    if(userAddress.toLowerCase()!=contractOwner.toLowerCase()){alert("Not owner!");return;}
    const to=document.getElementById("toInput").value;
    const amt=toUnits(document.getElementById("amtInput").value);
    const tx=await staking.emergencyWithdraw(to,amt);
    await tx.wait();
    alert("Emergency withdraw done");
  };

  document.getElementById("transferBtn").onclick=async()=>{
    if(userAddress.toLowerCase()!=contractOwner.toLowerCase()){alert("Not owner!");return;}
    const newO=document.getElementById("newOwnerInput").value;
    const tx=await staking.transferOwnership(newO);
    await tx.wait();
    alert("Ownership transferred");
  };
})();
</script>
</body>
</html>
