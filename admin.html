<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‚öôÔ∏è Admin Panel - USDT Staking</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0d0d0d;
      color: white;
      text-align: center;
    }
    h1 { margin-top: 20px; }
    .card {
      background: #1a1a1a;
      border-radius: 12px;
      padding: 20px;
      margin: 20px auto;
      width: 450px;
      box-shadow: 0px 0px 10px rgba(255,255,255,0.1);
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
    .primary { background: gold; color: black; }
    .danger { background: crimson; color: white; }
    .secondary { background: #333; color: white; }
    input {
      padding: 10px;
      margin: 5px;
      width: 90%;
      border-radius: 8px;
      border: none;
      text-align: center;
    }
    .status { margin-top: 10px; font-size: 14px; color: gray; }
  </style>
</head>
<body>
  <h1>‚öôÔ∏è Admin Panel ‚Äî USDT Staking</h1>
  <button id="connectBtn" class="primary">üîó Connect Wallet</button>
  <p id="walletStatus">Wallet: not connected</p>

  <!-- Stats -->
  <div class="card">
    <h2>üìä Contract Stats</h2>
    <button id="checkStatsBtn" class="secondary">Check Stats</button>
    <p id="statsInfo">-</p>
  </div>

  <!-- Update Params -->
  <div class="card">
    <h2>üîß Update Parameters</h2>
    <input id="roi" placeholder="ROI Basis Points (1800=18%)">
    <input id="lock" placeholder="Lock Period (seconds)">
    <input id="minTx" placeholder="Min Stake (smallest units)">
    <input id="capX" placeholder="Cap Multiplier (3x)">
    <button id="setParamsBtn" class="primary">Update Params</button>
  </div>

  <!-- Emergency Withdraw -->
  <div class="card">
    <h2>üö® Emergency Withdraw</h2>
    <input id="toAddr" placeholder="To Address">
    <input id="amount" placeholder="Amount (USDT)">
    <button id="emergencyBtn" class="danger">Withdraw</button>
  </div>

  <!-- Transfer Ownership -->
  <div class="card">
    <h2>üëë Transfer Ownership</h2>
    <input id="newOwner" placeholder="New Owner Address">
    <button id="transferOwnerBtn" class="primary">Transfer Ownership</button>
  </div>

  <p class="status" id="status"></p>

  <script>
    const stakingAddress = "0xC762eA92B653aCc0C752C90AD44e026980551c60";
    const tokenAddress = "0xEbA5032Be8fc2d2a2fa29e134853ab6aAA12fa1C";
    const stakingABI = [
      "function roiBP() view returns(uint256)",
      "function lockSeconds() view returns(uint256)",
      "function minTx() view returns(uint256)",
      "function capX() view returns(uint256)",
      "function totalStaked() view returns(uint256)",
      "function totalRewards() view returns(uint256)",
      "function owner() view returns(address)",
      "function setParams(uint256,uint256,uint256,uint256) external",
      "function emergencyWithdraw(address to, uint256 amount) external",
      "function transferOwnership(address newOwner) external"
    ];

    let provider, signer, staking, userAddress;

    async function connectWallet() {
      try {
        if (!window.ethereum) throw new Error("MetaMask not found");
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        userAddress = await signer.getAddress();
        staking = new ethers.Contract(stakingAddress, stakingABI, signer);
        document.getElementById("walletStatus").innerText = "Wallet: " + userAddress;
        document.getElementById("status").innerText = "Connected ‚úÖ";
      } catch (err) {
        alert("Wallet connect failed: " + err.message);
      }
    }

    async function checkStats() {
      try {
        const roi = await staking.roiBP();
        const lock = await staking.lockSeconds();
        const minTx = await staking.minTx();
        const capX = await staking.capX();
        const staked = await staking.totalStaked();
        const rewards = await staking.totalRewards();
        const owner = await staking.owner();

        document.getElementById("statsInfo").innerText =
          `ROI: ${roi} BP | Lock: ${lock} sec | MinTx: ${minTx} | CapX: ${capX}\n` +
          `Total Staked: ${(staked/1e6).toFixed(2)} USDT | Total Rewards: ${(rewards/1e6).toFixed(2)} USDT\n` +
          `Owner: ${owner}`;
      } catch (err) { alert("Check stats failed: " + err.message); }
    }

    async function setParams() {
      try {
        const roi = document.getElementById("roi").value;
        const lock = document.getElementById("lock").value;
        const minTx = document.getElementById("minTx").value;
        const capX = document.getElementById("capX").value;
        let tx = await staking.setParams(roi, lock, minTx, capX);
        await tx.wait();
        document.getElementById("status").innerText = "Params updated ‚úÖ";
      } catch (err) { alert("Set params failed: " + err.message); }
    }

    async function emergencyWithdraw() {
      try {
        const to = document.getElementById("toAddr").value;
        const amount = ethers.utils.parseUnits(document.getElementById("amount").value, 6);
        let tx = await staking.emergencyWithdraw(to, amount);
        await tx.wait();
        document.getElementById("status").innerText = "Emergency Withdraw ‚úÖ";
      } catch (err) { alert("Emergency withdraw failed: " + err.message); }
    }

    async function transferOwnership() {
      try {
        const newOwner = document.getElementById("newOwner").value;
        let tx = await staking.transferOwnership(newOwner);
        await tx.wait();
        document.getElementById("status").innerText = "Ownership Transferred ‚úÖ";
      } catch (err) { alert("Transfer failed: " + err.message); }
    }

    // Bindings
    document.getElementById("connectBtn").onclick = connectWallet;
    document.getElementById("checkStatsBtn").onclick = checkStats;
    document.getElementById("setParamsBtn").onclick = setParams;
    document.getElementById("emergencyBtn").onclick = emergencyWithdraw;
    document.getElementById("transferOwnerBtn").onclick = transferOwnership;
  </script>
</body>
</html>
