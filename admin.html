<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‚öôÔ∏è Admin Panel - USDT Staking</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <style>
    body { background:#0d0d0d; color:#fff; font-family:Arial; text-align:center; }
    .card { background:#1e1e1e; padding:20px; margin:20px auto; width:500px; border-radius:12px; }
    button { padding:10px 20px; border:none; border-radius:6px; margin:5px; cursor:pointer; }
    .primary { background:#facc15; color:#000; }
    .secondary { background:#333; color:#fff; }
    .danger { background:#ef4444; color:#fff; }
    input { padding:8px; margin:5px; width:80%; border-radius:6px; border:none; text-align:center; }
  </style>
</head>
<body>
  <h2>‚öôÔ∏è USDT Staking ‚Äî Admin Panel</h2>

  <button id="connectBtn" class="primary" onclick="connectWallet()">üîó Connect Wallet</button>
  <p id="wallet-address">Wallet: not connected</p>

  <div class="card">
    <h3>Contract Info</h3>
    <p id="owner">Owner: -</p>
    <p id="roi">ROI (basis points): -</p>
    <p id="lock">Lock Period: - days</p>
    <p id="minTx">Minimum TX: - USDT</p>
    <p id="capx">CapX (max 3x): -</p>
    <p id="totalStaked">Total Staked: - USDT</p>
    <p id="totalRewards">Total Rewards: - USDT</p>
    <button class="secondary" onclick="loadInfo()">üîÑ Refresh Info</button>
  </div>

  <div class="card">
    <h3>Update Params</h3>
    <input id="roiInput" type="number" placeholder="ROI (basis points)">
    <input id="lockInput" type="number" placeholder="Lock Period (seconds)">
    <input id="minTxInput" type="number" placeholder="Min TX (USDT)">
    <input id="capxInput" type="number" placeholder="CapX multiplier">
    <button class="primary" onclick="setParams()">‚ö° Update Params</button>
  </div>

<script>
let web3;
let accounts;

const STAKING_ADDRESS = "0x20Fbd4AF3cB507e702C7C513F08D7857bAc74407";

// ‚úÖ Staking ABI (Admin functions included)
const stakingAbi = [
  { "inputs":[],"stateMutability":"nonpayable","type":"constructor" },
  { "inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],
    "stateMutability":"view","type":"function"},
  { "inputs":[],"name":"roiBP","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],
    "stateMutability":"view","type":"function"},
  { "inputs":[],"name":"lockSeconds","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],
    "stateMutability":"view","type":"function"},
  { "inputs":[],"name":"minTx","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],
    "stateMutability":"view","type":"function"},
  { "inputs":[],"name":"capX","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],
    "stateMutability":"view","type":"function"},
  { "inputs":[],"name":"totalStaked","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],
    "stateMutability":"view","type":"function"},
  { "inputs":[],"name":"totalRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],
    "stateMutability":"view","type":"function"},
  { "inputs":[
      {"internalType":"uint256","name":"_roiBP","type":"uint256"},
      {"internalType":"uint256","name":"_lockSeconds","type":"uint256"},
      {"internalType":"uint256","name":"_minTx","type":"uint256"},
      {"internalType":"uint256","name":"_capX","type":"uint256"}
    ],
    "name":"setParams","outputs":[],"stateMutability":"nonpayable","type":"function"}
];

let stakingContract;

// ‚úÖ Connect Wallet
async function connectWallet() {
  if (typeof window.ethereum !== "undefined") {
    await window.ethereum.request({ method: "eth_requestAccounts" });
    web3 = new Web3(window.ethereum);
    accounts = await web3.eth.getAccounts();
    document.getElementById("wallet-address").innerText = "Wallet: " + accounts[0];
    stakingContract = new web3.eth.Contract(stakingAbi, STAKING_ADDRESS);
    loadInfo();
  } else {
    alert("MetaMask not found!");
  }
}

// ‚úÖ Load contract info
async function loadInfo() {
  const owner = await stakingContract.methods.owner().call();
  const roi = await stakingContract.methods.roiBP().call();
  const lock = await stakingContract.methods.lockSeconds().call();
  const minTx = await stakingContract.methods.minTx().call();
  const capx = await stakingContract.methods.capX().call();
  const totalStaked = await stakingContract.methods.totalStaked().call();
  const totalRewards = await stakingContract.methods.totalRewards().call();

  document.getElementById("owner").innerText = "Owner: " + owner;
  document.getElementById("roi").innerText = "ROI (basis points): " + roi;
  document.getElementById("lock").innerText = "Lock Period: " + (lock/86400) + " days";
  document.getElementById("minTx").innerText = "Minimum TX: " + (minTx/1e6) + " USDT";
  document.getElementById("capx").innerText = "CapX (max): " + capx;
  document.getElementById("totalStaked").innerText = "Total Staked: " + (totalStaked/1e6) + " USDT";
  document.getElementById("totalRewards").innerText = "Total Rewards: " + (totalRewards/1e6) + " USDT";
}

// ‚úÖ Update Params
async function setParams() {
  let roi = document.getElementById("roiInput").value;
  let lock = document.getElementById("lockInput").value;
  let minTx = document.getElementById("minTxInput").value;
  let capx = document.getElementById("capxInput").value;

  if(!roi || !lock || !minTx || !capx) {
    alert("Please fill all fields!");
    return;
  }

  await stakingContract.methods
    .setParams(roi, lock, minTx*1e6, capx)
    .send({ from: accounts[0] });

  alert("Params updated successfully!");
  loadInfo();
}
</script>
</body>
</html>
