<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - USDT Staking</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #fff; text-align: center; padding: 30px; }
    button { margin: 5px; padding: 10px 15px; cursor: pointer; border: none; border-radius: 5px; }
    input { padding: 8px; margin: 5px; border-radius: 5px; border: none; }
    .container { margin-top: 20px; padding: 20px; border: 1px solid #444; border-radius: 10px; }
  </style>
</head>
<body>
  <h2>‚öôÔ∏è USDT Staking Admin Panel</h2>
  <button onclick="connectWallet()">üîó Connect Wallet</button>
  <p id="wallet">Wallet: Not connected</p>

  <div class="container">
    <h3>üìä Global Stats</h3>
    <p id="totalStaked">Total Staked: 0 USDT</p>
    <p id="totalRewards">Total Rewards Distributed: 0 USDT</p>
    <p id="roi">ROI: 0 %</p>
    <p id="capx">CapX: 0x</p>
    <p id="totalUsers">Total Users: 0</p>
    <button onclick="loadStats()">üîÑ Refresh Stats</button>
  </div>

  <div class="container">
    <h3>‚öôÔ∏è Admin Controls</h3>
    <input type="number" id="roiBP" placeholder="ROI (basis points)">
    <input type="number" id="lockSeconds" placeholder="Lock Seconds">
    <input type="number" id="capX" placeholder="CapX">
    <button onclick="setParams()">Update Params</button>
  </div>

  <script>
    // ================== CONFIG ==================
    const STAKING_ADDRESS = "0x8B336d8c0e8905aAd3583D93D187A9072e647662"; // replace
    const TOKEN_ADDRESS   = "0xEbA5032Be8fc2d2a2fa29e134853ab6aAA12fa1C";   // replace

    // =============== ABI IMPORT ===============
    const stakingAbi = [
      { "inputs":[],"name":"totalStaked","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function" },
      { "inputs":[],"name":"totalRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function" },
      { "inputs":[],"name":"roiBP","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function" },
      { "inputs":[],"name":"capX","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function" },
      { "inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function" },
      { "inputs":[{"internalType":"uint256","name":"_roiBP","type":"uint256"},{"internalType":"uint256","name":"_lockSeconds","type":"uint256"},{"internalType":"uint256","name":"_capX","type":"uint256"}],
        "name":"setParams","outputs":[],"stateMutability":"nonpayable","type":"function" },
      { "inputs":[{"internalType":"address","name":"","type":"address"}],
        "name":"users","outputs":[
          {"internalType":"uint256","name":"staked","type":"uint256"},
          {"internalType":"uint256","name":"rewardDebt","type":"uint256"},
          {"internalType":"uint256","name":"lastAction","type":"uint256"},
          {"internalType":"address","name":"referrer","type":"address"},
          {"internalType":"uint256","name":"totalEarned","type":"uint256"}],
        "stateMutability":"view","type":"function"
      }
    ];

    let web3, accounts, stakingContract;

    async function connectWallet() {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        accounts = await ethereum.request({ method: "eth_requestAccounts" });
        document.getElementById("wallet").innerText = "Wallet: " + accounts[0];
        stakingContract = new web3.eth.Contract(stakingAbi, STAKING_ADDRESS);
      } else {
        alert("Please install MetaMask!");
      }
    }

    async function loadStats() {
      const staked = await stakingContract.methods.totalStaked().call();
      const rewards = await stakingContract.methods.totalRewards().call();
      const roiBP = await stakingContract.methods.roiBP().call();
      const capX = await stakingContract.methods.capX().call();

      // Approx user count: by reading from events (simplified demo -> showing stakers by manual fetch is better in real)
      let totalUsers = "Not tracked directly";

      document.getElementById("totalStaked").innerText = "Total Staked: " + (staked / 1e6) + " USDT";
      document.getElementById("totalRewards").innerText = "Total Rewards Distributed: " + (rewards / 1e6) + " USDT";
      document.getElementById("roi").innerText = "ROI: " + (roiBP / 100) + " %";
      document.getElementById("capx").innerText = "CapX: " + capX + "x";
      document.getElementById("totalUsers").innerText = "Total Users: " + totalUsers;
    }

    async function setParams() {
      const roiBP = document.getElementById("roiBP").value;
      const lockSeconds = document.getElementById("lockSeconds").value;
      const capX = document.getElementById("capX").value;

      await stakingContract.methods.setParams(roiBP, lockSeconds, capX).send({ from: accounts[0] });
      alert("Parameters updated!");
    }
  </script>
</body>
</html>
