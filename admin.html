<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>USDT Staking ‚Äî Admin Panel</title>
  <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
  <style>
    body { background:#0d0d0d; color:#f5f5f5; font-family: Arial, sans-serif; text-align:center; }
    h2 { margin-top:20px; }
    button { padding:10px 18px; border:none; cursor:pointer; border-radius:6px; font-weight:bold; }
    .yellow { background:#f5c518; color:#000; }
    .red { background:#e63946; color:#fff; }
    .green { background:#06d6a0; color:#000; }
    .card { background:#1a1a1a; margin:20px auto; padding:20px; border-radius:10px; width:400px; text-align:left; }
    input { width:100%; padding:8px; margin:5px 0; border-radius:5px; border:none; }
    .status { margin:10px 0; font-weight:bold; }
  </style>
</head>
<body>
  <h2>‚öôÔ∏è USDT Staking ‚Äî Admin Panel</h2>
  <button id="connectBtn" class="yellow">Connect Wallet</button>
  <div id="walletAddress">Wallet: Not Connected</div>
  <div id="adminStatus" class="status"></div>

  <!-- Contract Stats -->
  <div class="card">
    <h3>üìä Contract Stats</h3>
    <div id="contractStats">-</div>
    <button onclick="refreshStats()" class="green">Refresh Stats</button>
  </div>

  <!-- Update Params -->
  <div class="card">
    <h3>üîß Update Parameters</h3>
    <input id="roiBP" placeholder="ROI BP (e.g. 1800)">
    <input id="lockSec" placeholder="Lock Period (sec)">
    <input id="minTx" placeholder="MinTx (USDT)">
    <input id="capX" placeholder="CapX (e.g. 3)">
    <button onclick="updateParams()" class="yellow">Update Params</button>
  </div>

  <!-- Withdrawal Requests -->
  <div class="card">
    <h3>üí∏ Pending Withdrawals</h3>
    <div id="withdrawList">No pending requests</div>
  </div>

  <!-- Emergency Withdraw -->
  <div class="card">
    <h3>üö® Emergency Withdraw</h3>
    <input id="emgTo" placeholder="Recipient Address">
    <input id="emgAmt" placeholder="Amount (USDT)">
    <button onclick="emergencyWithdraw()" class="red">Execute</button>
  </div>

  <!-- Mint (Testnet only) -->
  <div class="card">
    <h3>ü™ô Mint USDT (Testnet only)</h3>
    <input id="mintAmt" placeholder="Amount (USDT)">
    <button onclick="mintUSDT()" class="yellow">Mint</button>
  </div>

  <script>
    const CONTRACT_ADDRESS = "0x3aF2c75A4723b2139EB803bf5d558e7d43991D6E"; 
    const TOKEN_ADDRESS = "0xEbA5032Be8fc2d2a2fa29e134853ab6aAA12fa1C"; 

    let provider, signer, contract, token, account;

    // ‚úÖ Staking Contract ABI (shortened for Admin functions only)
    const CONTRACT_ABI = [
      "function owner() view returns(address)",
      "function roiBP() view returns(uint256)",
      "function lockSeconds() view returns(uint256)",
      "function minTx() view returns(uint256)",
      "function capX() view returns(uint256)",
      "function totalStaked() view returns(uint256)",
      "function totalRewards() view returns(uint256)",
      "function setParams(uint256,uint256,uint256,uint256) external",
      "function emergencyWithdraw(address,uint256) external",
      "event ParamsUpdated(uint256,uint256,uint256,uint256)"
    ];

    const TOKEN_ABI = [
      "function mint(address to,uint256 amount) external"
    ];

    async function connectWallet(){
      if(window.ethereum){
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        account = await signer.getAddress();
        document.getElementById("walletAddress").innerText = "Wallet: " + account;
        contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
        token = new ethers.Contract(TOKEN_ADDRESS, TOKEN_ABI, signer);
        checkOwner();
        refreshStats();
      } else {
        alert("Please install MetaMask!");
      }
    }

    async function checkOwner(){
      const owner = await contract.owner();
      if(owner.toLowerCase() === account.toLowerCase()){
        document.getElementById("adminStatus").innerText = "‚úÖ You are the Admin";
      } else {
        document.getElementById("adminStatus").innerText = "‚ùå Not an Admin Wallet";
      }
    }

    async function refreshStats(){
      const roi = await contract.roiBP();
      const lock = await contract.lockSeconds();
      const minTx = await contract.minTx();
      const capX = await contract.capX();
      const staked = await contract.totalStaked();
      const rewards = await contract.totalRewards();
      document.getElementById("contractStats").innerHTML = `
        ROI: ${roi} BP (~${roi/100}%/yr)<br>
        Lock: ${lock} sec<br>
        MinTx: ${(minTx/1e6).toFixed(2)} USDT<br>
        CapX: ${capX}x<br>
        Total Staked: ${(staked/1e6).toFixed(2)} USDT<br>
        Total Rewards: ${(rewards/1e6).toFixed(6)} USDT
      `;
    }

    async function updateParams(){
      const roi = document.getElementById("roiBP").value;
      const lock = document.getElementById("lockSec").value;
      const minTx = document.getElementById("minTx").value * 1e6;
      const capX = document.getElementById("capX").value;
      const tx = await contract.setParams(roi, lock, minTx, capX);
      await tx.wait();
      alert("Params Updated!");
      refreshStats();
    }

    async function emergencyWithdraw(){
      const to = document.getElementById("emgTo").value;
      const amt = document.getElementById("emgAmt").value * 1e6;
      const tx = await contract.emergencyWithdraw(to, amt);
      await tx.wait();
      alert("Emergency Withdraw Successful");
    }

    async function mintUSDT(){
      const amt = document.getElementById("mintAmt").value * 1e6;
      const tx = await token.mint(account, amt);
      await tx.wait();
      alert("Minted " + amt/1e6 + " USDT");
    }

    document.getElementById("connectBtn").addEventListener("click", connectWallet);
  </script>
</body>
</html>
