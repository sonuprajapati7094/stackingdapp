<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>USDT Staking — Admin</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <style>
    body{background:#071014;color:#fff;font-family:Inter,Arial;padding:20px}
    .wrap{max-width:1000px;margin:0 auto}
    .card{background:#0e1416;padding:16px;border-radius:10px;margin-bottom:12px}
    .btn{background:#f6c84c;color:#000;padding:8px 12px;border:none;border-radius:8px;cursor:pointer}
    input{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:#fff}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03)}
  </style>
</head>
<body>
<div class="wrap">
  <h2>Admin Panel — USDT Staking</h2>
  <div class="card">
    <div><b>Connected as:</b> <span id="addr"></span></div>
    <div style="margin-top:10px"><button id="connect" class="btn">Connect MetaMask</button></div>
  </div>

  <div class="card">
    <h3>Withdraw Approval</h3>
    <div class="row" style="display:flex;gap:8px">
      <input id="wid" placeholder="Withdrawal ID"/>
      <button id="approveWid" class="btn">Approve Withdrawal</button>
    </div>
    <div id="approveResult" style="margin-top:8px;color:#ddd"></div>
  </div>

  <div class="card">
    <h3>Pause / Unpause User</h3>
    <div style="display:flex;gap:8px">
      <input id="pauseAddr" placeholder="user address"/>
      <button id="pauseBtn" class="btn">Pause</button>
      <button id="unpauseBtn" class="btn">Unpause</button>
    </div>
  </div>

  <div class="card">
    <h3>Set ROI / Fee</h3>
    <div style="display:flex;gap:8px">
      <input id="roiBps" placeholder="dailyROI bps (100 = 1%)"/>
      <input id="feeBps" placeholder="withdraw fee bps (500 = 5%)"/>
      <button id="setParams" class="btn">Set</button>
    </div>
    <div id="setResult" style="margin-top:8px;color:#ddd"></div>
  </div>

  <div class="card">
    <h3>Emergency</h3>
    <div style="display:flex;gap:8px">
      <input id="emTo" placeholder="to address"/>
      <button id="emBtn" class="btn">Emergency Withdraw All</button>
    </div>
    <div id="emRes" style="margin-top:8px;color:#ddd"></div>
  </div>
</div>

<script>
const CONFIG = {
  tokenAddress: "0x1a904b37B0d9D6ab755aBDa4656E42F278FC89AA",
  stakingAddress: "0xE65396C1B8c63167A86d374ec7aD8F1471CC1F2f",
  decimals: 6
};

const STAKING_ABI = [
  "function owner() external view returns (address)",
  "function approveWithdrawal(uint256 id) external",
  "function pauseUser(address userAddr) external",
  "function unpauseUser(address userAddr) external",
  "function setDailyRoi(uint256 bps) external",
  "function setWithdrawFee(uint256 bps) external",
  "function emergencyWithdrawAll(address to) external"
];

let provider, signer, addr, staking;

document.getElementById('connect').onclick = async () => {
  if (!window.ethereum) return alert("Install MetaMask");
  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = provider.getSigner();
  addr = await signer.getAddress();
  document.getElementById('addr').innerText = addr;
  staking = new ethers.Contract(CONFIG.stakingAddress, STAKING_ABI, signer);
  // verify owner
  const owner = await staking.owner();
  if (owner.toLowerCase() !== addr.toLowerCase()) {
    alert("Warning: Connected account is not owner. Admin actions will fail.");
  }
};

document.getElementById('approveWid').onclick = async () => {
  const id = document.getElementById('wid').value;
  if (!id) return alert("Enter id");
  try {
    const tx = await staking.approveWithdrawal(Number(id));
    await tx.wait();
    document.getElementById('approveResult').innerText = "Approved id " + id;
  } catch(e){ console.error(e); alert("Approve failed: " + (e?.message || e)); }
};

document.getElementById('pauseBtn').onclick = async () => {
  const a = document.getElementById('pauseAddr').value;
  if (!a) return alert("addr");
  try { const tx = await staking.pauseUser(a); await tx.wait(); alert("Paused"); } catch(e){ alert(e?.message||e) }
};
document.getElementById('unpauseBtn').onclick = async () => {
  const a = document.getElementById('pauseAddr').value;
  if (!a) return alert("addr");
  try { const tx = await staking.unpauseUser(a); await tx.wait(); alert("Unpaused"); } catch(e){ alert(e?.message||e) }
};

document.getElementById('setParams').onclick = async () => {
  const r = document.getElementById('roiBps').value;
  const f = document.getElementById('feeBps').value;
  if (!r && !f) return alert("Enter params");
  try {
    if (r) { const tx = await staking.setDailyRoi(Number(r)); await tx.wait(); }
    if (f) { const tx2 = await staking.setWithdrawFee(Number(f)); await tx2.wait(); }
    document.getElementById('setResult').innerText = "Params updated";
  } catch(e){ alert("Failed: " + (e?.message||e)) }
};

document.getElementById('emBtn').onclick = async () => {
  const to = document.getElementById('emTo').value;
  if (!to) return alert("to address");
  try {
    const tx = await staking.emergencyWithdrawAll(to);
    await tx.wait();
    document.getElementById('emRes').innerText = "Emergency withdraw executed";
  } catch(e){ alert("Failed: " + (e?.message||e)) }
};

</script>
</body>
</html>
